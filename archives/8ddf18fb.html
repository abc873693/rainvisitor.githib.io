<!DOCTYPE html>
<html lang="zh-tw,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.rainvisitor.me","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ã€æ–‡ç« å…§å®¹ä½¿ç”¨ Gemini 1.5 Pro è‡ªå‹•ç”¢ç”Ÿã€‘ åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚Flutter 3.24 ç‰ˆæœ¬å¼•é€²äº†ä¸€å€‹æ–°çš„ä½éšåœ–å½¢ APIï¼Œç¨±ç‚º Flutter GPUã€‚é‚„æœ‰ä¸€å€‹ç”± Flutter GPU æ”¯æ´çš„ 3D æ¸²æŸ“å‡½å¼åº«ï¼Œç¨±ç‚º Flutter Sceneï¼ˆå¥—ä»¶ï¼šflutter_sceneï¼‰ã€‚Flutter GPU å’Œ Flutter Scene ç›®å‰éƒ½">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU">
<meta property="og:url" content="https://blog.rainvisitor.me/archives/8ddf18fb.html">
<meta property="og:site_name" content="RainVisitor Blog">
<meta property="og:description" content="ã€æ–‡ç« å…§å®¹ä½¿ç”¨ Gemini 1.5 Pro è‡ªå‹•ç”¢ç”Ÿã€‘ åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚Flutter 3.24 ç‰ˆæœ¬å¼•é€²äº†ä¸€å€‹æ–°çš„ä½éšåœ–å½¢ APIï¼Œç¨±ç‚º Flutter GPUã€‚é‚„æœ‰ä¸€å€‹ç”± Flutter GPU æ”¯æ´çš„ 3D æ¸²æŸ“å‡½å¼åº«ï¼Œç¨±ç‚º Flutter Sceneï¼ˆå¥—ä»¶ï¼šflutter_sceneï¼‰ã€‚Flutter GPU å’Œ Flutter Scene ç›®å‰éƒ½">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/900/0*hAqIOVkaI1IWnOHE">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*JEI3fLDGcRHWKruT">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*lKTtaX2ih6dFpSMQ">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*ebUDtzQOuIGmdlop">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*LWnGU5WPT_Eom0wJ">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*tC68CbPLef2rJp1e">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/912/0*vVWRLxJ348tCxv7T">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/912/0*74qs6ytcTjyVHwML">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/796/0*_-OFc0vhBHAhrPrO">
<meta property="article:published_time" content="2024-08-06T10:02:39.000Z">
<meta property="article:modified_time" content="2024-09-29T17:40:49.177Z">
<meta property="article:author" content="Rainvisitor">
<meta property="article:tag" content="flutter">
<meta property="article:tag" content="game-development">
<meta property="article:tag" content="3d">
<meta property="article:tag" content="guides-and-tutorials">
<meta property="article:tag" content="graphics-programming">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn-images-1.medium.com/max/900/0*hAqIOVkaI1IWnOHE">

<link rel="canonical" href="https://blog.rainvisitor.me/archives/8ddf18fb.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-tw'
  };
</script>

  <title>ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU | RainVisitor Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">RainVisitor Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">RainVisitor</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://blog.rainvisitor.me/archives/8ddf18fb.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rainvisitor">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RainVisitor Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-08-06 18:02:39" itemprop="dateCreated datePublished" datetime="2024-08-06T18:02:39+08:00">2024-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-09-30 01:40:49" itemprop="dateModified" datetime="2024-09-30T01:40:49+08:00">2024-09-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/" itemprop="url" rel="index"><span itemprop="name">Flutter</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ã€æ–‡ç« å…§å®¹ä½¿ç”¨ Gemini 1.5 Pro è‡ªå‹•ç”¢ç”Ÿã€‘</p>
<h2 id="åœ¨-Flutter-ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“-3D-å ´æ™¯ã€‚"><a href="#åœ¨-Flutter-ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“-3D-å ´æ™¯ã€‚" class="headerlink" title="åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚"></a>åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚</h2><p>Flutter 3.24 ç‰ˆæœ¬å¼•é€²äº†ä¸€å€‹æ–°çš„ä½éšåœ–å½¢ APIï¼Œç¨±ç‚º <a href="https://github.com/flutter/engine/blob/main/docs/impeller/Flutter-GPU.md">Flutter GPU</a>ã€‚é‚„æœ‰ä¸€å€‹ç”± Flutter GPU æ”¯æ´çš„ 3D æ¸²æŸ“å‡½å¼åº«ï¼Œç¨±ç‚º <a href="https://pub.dev/packages/flutter_scene">Flutter Scene</a>ï¼ˆå¥—ä»¶ï¼šflutter_sceneï¼‰ã€‚Flutter GPU å’Œ Flutter Scene ç›®å‰éƒ½è™•æ–¼é è¦½éšæ®µï¼Œåƒ…åœ¨ Flutter çš„ <a href="https://docs.flutter.dev/release/upgrade#other-channels">ä¸»é »é“</a> ä¸Šå¯ç”¨ï¼ˆç”±æ–¼ä¾è³´å¯¦é©—æ€§åŠŸèƒ½ï¼‰ï¼Œéœ€è¦ <a href="https://docs.flutter.dev/perf/impeller#availability">å•Ÿç”¨ Impeller</a>ï¼Œä¸¦ä¸”å¯èƒ½å¶çˆ¾æœƒå¼•å…¥é‡å¤§è®Šæ›´ã€‚</p>
<p>æœ¬æ–‡åŒ…å«é€™å…©å€‹å¥—ä»¶çš„å…©å€‹ã€Œå…¥é–€ã€æŒ‡å—ï¼š</p>
<ol>
<li>ğŸ”º <strong>é€²éšï¼š</strong><a href="#d558">ä½¿ç”¨ Flutter GPU å…¥é–€</a><br>å¦‚æœæ‚¨æ˜¯ç¶“é©—è±å¯Œçš„åœ–å½¢ç¨‹å¼è¨­è¨ˆå¸«ï¼Œæˆ–è€…æ‚¨å°ä½éšåœ–å½¢æ„Ÿèˆˆè¶£ï¼Œä¸¦æƒ³åœ¨ Flutter ä¸­å¾é ­é–‹å§‹å»ºç«‹æ¸²æŸ“å™¨ï¼Œé‚£éº¼æœ¬æŒ‡å—å°‡å¹«åŠ©æ‚¨é–‹å§‹ä½¿ç”¨ Flutter GPUã€‚æ‚¨å°‡å¾é ­é–‹å§‹ç¹ªè£½ç¬¬ä¸€å€‹ä¸‰è§’å½¢â€¦ åœ¨ Flutter ä¸­ï¼</li>
<li>ğŸ’š <strong>ä¸­ç´šï¼š</strong><a href="#6b35">ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“</a><br>å¦‚æœæ‚¨æ˜¯æƒ³è¦å°‡ 3D åŠŸèƒ½æ·»åŠ åˆ°æ‡‰ç”¨ç¨‹å¼ä¸­çš„ Flutter é–‹ç™¼äººå“¡ï¼Œæˆ–è€…æ‚¨æƒ³è¦ä½¿ç”¨ Dart å’Œ Flutter å»ºç«‹ 3D éŠæˆ²ï¼Œé‚£éº¼æœ¬æŒ‡å—é©åˆæ‚¨ï¼æ‚¨å°‡è¨­å®šä¸€å€‹å°ˆæ¡ˆï¼Œåœ¨ Flutter ä¸­åŒ¯å…¥å’Œæ¸²æŸ“ 3D è³‡ç”¢ã€‚</li>
</ol>
<h3 id="ä½¿ç”¨-Flutter-GPU-å…¥é–€"><a href="#ä½¿ç”¨-Flutter-GPU-å…¥é–€" class="headerlink" title="ä½¿ç”¨ Flutter GPU å…¥é–€"></a>ä½¿ç”¨ Flutter GPU å…¥é–€</h3><p>âš ï¸ è­¦å‘Šï¼âš ï¸ Flutter GPU æœ€çµ‚æ˜¯ä¸€å€‹ä½éš APIã€‚çµ•å¤§å¤šæ•¸å°‡å¾ Flutter GPU çš„å­˜åœ¨ä¸­å—ç›Šçš„ Flutter é–‹ç™¼äººå“¡å¾ˆå¯èƒ½æœƒé€éä½¿ç”¨åœ¨ pub.dev ä¸Šç™¼ä½ˆçš„æ›´é«˜éšæ¸²æŸ“å‡½å¼åº«ä¾†åšåˆ°é€™ä¸€é»ï¼Œä¾‹å¦‚ Flutter Scene æ¸²æŸ“å¥—ä»¶ã€‚å¦‚æœæ‚¨å° Flutter GPU API æœ¬èº«ä¸æ„Ÿèˆˆè¶£ï¼Œè€Œåªæ˜¯å° 3D æ¸²æŸ“æ„Ÿèˆˆè¶£ï¼Œè«‹è·³åˆ° <a href="#6b35">ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“</a>ã€‚</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/900/0*hAqIOVkaI1IWnOHE" />
<figcaption>å“¦ï¼ŒçœŸé–ƒäº®ã€‚é€™æ˜¯ä¸€å€‹å°„ç·šè¡Œé€²çš„ç¬¦è™Ÿè·é›¢å ´ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Flutter GPU æ¸²æŸ“å®ƒï¼Œä½†ä½¿ç”¨ [è‡ªè¨‚ç‰‡æ®µè‘—è‰²å™¨](https://docs.flutter.dev/ui/design/graphics/fragment-shaders) ä¹Ÿå®Œå…¨æœ‰å¯èƒ½ã€‚ </figcaption>
</figure>

<h3 id="ä½¿ç”¨-Flutter-GPU-å…¥é–€-1"><a href="#ä½¿ç”¨-Flutter-GPU-å…¥é–€-1" class="headerlink" title="ä½¿ç”¨ Flutter GPU å…¥é–€"></a>ä½¿ç”¨ Flutter GPU å…¥é–€</h3><p>Flutter GPU æ˜¯ Flutter å…§å»ºçš„ä½éšåœ–å½¢ APIã€‚å®ƒå…è¨±æ‚¨é€éæ’°å¯« Dart ç¨‹å¼ç¢¼å’Œ GLSL è‘—è‰²å™¨åœ¨ Flutter ä¸­å»ºç«‹å’Œæ•´åˆè‡ªè¨‚æ¸²æŸ“å™¨ã€‚ä¸éœ€è¦åŸç”Ÿå¹³å°ç¨‹å¼ç¢¼ã€‚</p>
<p>ç›®å‰ï¼ŒFlutter GPU è™•æ–¼æ—©æœŸé è¦½éšæ®µï¼Œä¸¦æä¾›åŸºæœ¬çš„æŸµæ ¼åŒ– APIï¼Œä½†éš¨è‘— API é€æ¼¸ç©©å®šï¼Œå°‡æœƒç¹¼çºŒæ–°å¢å’Œæ”¹é€²æ›´å¤šåŠŸèƒ½ã€‚</p>
<p>Flutter GPU é‚„éœ€è¦ <a href="https://docs.flutter.dev/perf/impeller#availability">å•Ÿç”¨ Impeller</a>ã€‚é€™è¡¨ç¤ºå®ƒåªèƒ½åœ¨ Impeller æ”¯æ´çš„å¹³å°ä¸Šä½¿ç”¨ã€‚åœ¨æ’°å¯«æœ¬æ–‡æ™‚ï¼ŒImpeller æ”¯æ´ï¼š</p>
<ul>
<li>iOSï¼ˆé è¨­å•Ÿç”¨ï¼‰</li>
<li>macOSï¼ˆé¸æ“‡æ€§é è¦½ï¼‰</li>
<li>Androidï¼ˆé¸æ“‡æ€§é è¦½ï¼‰</li>
</ul>
<p>æˆ‘å€‘å° Flutter GPU çš„ç›®æ¨™æ˜¯æœ€çµ‚æ”¯æ´æ‰€æœ‰ Flutter çš„å¹³å°ç›®æ¨™ã€‚æœ€çµ‚ç›®æ¨™æ˜¯ä¿ƒé€² Flutter ä¸­è·¨å¹³å°æ¸²æŸ“è§£æ±ºæ–¹æ¡ˆçš„ç”Ÿæ…‹ç³»çµ±ï¼Œé€™äº›è§£æ±ºæ–¹æ¡ˆå°æ–¼å¥—ä»¶ä½œè€…ä¾†èªªæ˜“æ–¼ç¶­è­·ï¼Œå°æ–¼ä½¿ç”¨è€…ä¾†èªªæ˜“æ–¼å®‰è£ã€‚</p>
<p>3D æ¸²æŸ“åªæ˜¯ä¸€å€‹å¯èƒ½çš„ç”¨ä¾‹ã€‚Flutter GPU ä¹Ÿå¯ä»¥ç”¨æ–¼å»ºç«‹å°ˆç”¨çš„ 2D æ¸²æŸ“å™¨ï¼Œæˆ–è€…åŸ·è¡Œæ›´éæ­£çµ±çš„æ“ä½œï¼Œä¾‹å¦‚æ¸²æŸ“ 4D ç©ºé–“çš„ 3D åˆ‡ç‰‡ï¼Œæˆ–æŠ•å½±éæ­å¹¾é‡Œå¾·ç©ºé–“ã€‚</p>
<p>ç”± Flutter GPU æ”¯æ´çš„è‡ªè¨‚ 2D æ¸²æŸ“å™¨çš„çµ•ä½³ç”¨ä¾‹ç¯„ä¾‹å°‡æ˜¯ä¾è³´éª¨éª¼ç¶²æ ¼è®Šå½¢çš„ 2D è§’è‰²å‹•ç•«æ ¼å¼ã€‚Spine 2D å°±æ˜¯ä¸€å€‹å¾ˆå¥½çš„ä¾‹å­ã€‚é€™ç¨®éª¨éª¼ç¶²æ ¼è§£æ±ºæ–¹æ¡ˆé€šå¸¸å…·æœ‰å‹•ç•«å‰ªè¼¯ï¼Œé€™äº›å‰ªè¼¯æœƒæ“ç¸±å±¤æ¬¡çµæ§‹ä¸­éª¨éª¼çš„å¹³ç§»ã€æ—‹è½‰å’Œç¸®æ”¾å±¬æ€§ï¼Œä¸¦ä¸”æ¯å€‹é ‚é»éƒ½å…·æœ‰ä¸€äº›é—œè¯çš„ã€Œéª¨éª¼æ¬Šé‡ã€ï¼Œé€™äº›æ¬Šé‡æ±ºå®šå“ªäº›éª¨éª¼æ‡‰è©²å½±éŸ¿é ‚é»ï¼Œä»¥åŠå½±éŸ¿ç¨‹åº¦ã€‚</p>
<p>ä½¿ç”¨åƒ drawVertices é€™æ¨£çš„ Canvas è§£æ±ºæ–¹æ¡ˆï¼Œéœ€è¦åœ¨ CPU ä¸Šå°æ¯å€‹é ‚é»æ‡‰ç”¨éª¨éª¼æ¬Šé‡è½‰æ›ã€‚ä½¿ç”¨ Flutter GPUï¼Œéª¨éª¼è½‰æ›å¯ä»¥ä»¥çµ±ä¸€é™£åˆ—æˆ–ç”šè‡³ç´‹ç†å–æ¨£å™¨çš„å½¢å¼å‚³éåˆ°é ‚é»è‘—è‰²å™¨ï¼Œå…è¨±æ ¹æ“šéª¨éª¼ç‹€æ…‹å’Œæ¯å€‹é ‚é»çš„éª¨éª¼æ¬Šé‡åœ¨ GPU ä¸Šä¸¦è¡Œè¨ˆç®—æ¯å€‹é ‚é»çš„æœ€çµ‚ä½ç½®ã€‚</p>
<p>èªªåˆ°æ­¤ï¼Œè®“æˆ‘å€‘é€éä¸€å€‹æº«å’Œçš„ä»‹ç´¹ä¾†é–‹å§‹ä½¿ç”¨ Flutter GPUï¼šç¹ªè£½æ‚¨çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢ï¼</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*JEI3fLDGcRHWKruT" />
</figure>

<h3 id="å°‡-Flutter-GPU-åŠ å…¥æ‚¨çš„å°ˆæ¡ˆ"><a href="#å°‡-Flutter-GPU-åŠ å…¥æ‚¨çš„å°ˆæ¡ˆ" class="headerlink" title="å°‡ Flutter GPU åŠ å…¥æ‚¨çš„å°ˆæ¡ˆ"></a>å°‡ Flutter GPU åŠ å…¥æ‚¨çš„å°ˆæ¡ˆ</h3><p>é¦–å…ˆï¼Œè«‹æ³¨æ„ Flutter GPU ç›®å‰è™•æ–¼æ—©æœŸé è¦½ç‹€æ…‹ï¼Œå¯èƒ½æœƒç™¼ç”Ÿ API æ–·è£‚ã€‚ç›®å‰ API å·²ç¶“å¯ä»¥å¯¦ç¾å¾ˆå¤šåŠŸèƒ½ï¼Œä½†æ˜¯æœ‰ç¶“é©—çš„åœ–å½¢å·¥ç¨‹å¸«å¯èƒ½æœƒæ³¨æ„åˆ°ä¸€äº›ç¼ºå¤±çš„å¸¸è¦‹åŠŸèƒ½ã€‚Flutter GPU åœ¨æ¥ä¸‹ä¾†çš„å¹¾å€‹æœˆè£¡å°‡æœƒæ–°å¢è¨±å¤šåŠŸèƒ½ã€‚</p>
<p>åŸºæ–¼é€™äº›åŸå› ï¼Œå¼·çƒˆå»ºè­°æ‚¨åœ¨é‡å° Flutter GPU é–‹ç™¼å¥—ä»¶æ™‚ï¼Œæš«æ™‚ä½¿ç”¨ <a href="https://docs.flutter.dev/release/upgrade#other-channels">ä¸»é »é“</a> çš„é ‚ç«¯ã€‚å¦‚æœæ‚¨é‡åˆ°ä»»ä½•æ„å¤–è¡Œç‚ºã€éŒ¯èª¤æˆ–æœ‰åŠŸèƒ½è«‹æ±‚ï¼Œè«‹ä½¿ç”¨æ¨™æº–çš„ <a href="https://github.com/flutter/flutter/issues/new/choose">Flutter å•é¡Œç¯„æœ¬</a> åœ¨ GitHub ä¸Šæäº¤å•é¡Œã€‚èˆ‡ Flutter GPU ç›¸é—œçš„æ‰€æœ‰è¿½è¹¤å•é¡Œéƒ½æ¨™è¨˜ç‚º <a href="https://github.com/flutter/flutter/labels/flutter-gpu">flutter-gpu æ¨™ç±¤</a>ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨è©¦é©— Flutter GPU ä¹‹å‰ï¼Œè«‹é€éåŸ·è¡Œä»¥ä¸‹å‘½ä»¤å°‡ Flutter åˆ‡æ›åˆ° main channelã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter channel main</span><br><span class="line">flutter upgrade</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨å»ºç«‹ä¸€å€‹æ–°çš„ Flutter å°ˆæ¡ˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter create my_cool_renderer</span><br><span class="line">cd my_cool_renderer</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†ï¼Œå°‡ flutter_gpu SDK å¥—ä»¶åŠ å…¥åˆ°æ‚¨çš„ pubspec ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_gpu --sdk=flutter</span><br></pre></td></tr></table></figure>

<h3 id="å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚"><a href="#å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚" class="headerlink" title="å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚"></a>å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚</h3><p>ç‚ºäº†ä½¿ç”¨ Flutter GPU æ¸²æŸ“ä»»ä½•æ±è¥¿ï¼Œæ‚¨éœ€è¦æ’°å¯«ä¸€äº› GLSL è‘—è‰²å™¨ã€‚Flutter GPU çš„è‘—è‰²å™¨èˆ‡ Flutter çš„ <a href="https://docs.flutter.dev/ui/design/graphics/fragment-shaders">ç‰‡æ®µè‘—è‰²å™¨</a> åŠŸèƒ½æ‰€ä½¿ç”¨çš„è‘—è‰²å™¨å…·æœ‰ä¸åŒçš„èªç¾©ï¼Œç‰¹åˆ¥æ˜¯åœ¨çµ±ä¸€ç¹«çµæ–¹é¢ã€‚æ‚¨é‚„éœ€è¦å®šç¾©ä¸€å€‹é ‚é»è‘—è‰²å™¨ï¼Œèˆ‡ç‰‡æ®µè‘—è‰²å™¨ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>å¾å®šç¾©æœ€ç°¡å–®çš„è‘—è‰²å™¨é–‹å§‹ã€‚æ‚¨å¯ä»¥å°‡è‘—è‰²å™¨æ”¾ç½®åœ¨å°ˆæ¡ˆä¸­çš„ä»»ä½•ä½ç½®ï¼Œä½†æ˜¯å°æ–¼æ­¤ç¯„ä¾‹ï¼Œè«‹å»ºç«‹ä¸€å€‹ shaders ç›®éŒ„ï¼Œä¸¦ä½¿ç”¨å…©å€‹è‘—è‰²å™¨å¡«å……å®ƒï¼šsimple.vert å’Œ simple.fragã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šshaders/simple.vert</span><br><span class="line"></span><br><span class="line">in vec2 position;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">  gl_Position = vec4(position, 0.0, 1.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¹ªè£½ä¸‰è§’å½¢æ™‚ï¼Œæ‚¨å°‡æ“æœ‰ä¸€å€‹å®šç¾©æ¯å€‹é ‚é»çš„è³‡æ–™åˆ—è¡¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒåƒ…åˆ—å‡º 2D ä½ç½®ã€‚å°æ–¼é€™äº›é ‚é»ä¸­çš„æ¯ä¸€å€‹ï¼Œç°¡å–®çš„é ‚é»è‘—è‰²å™¨éƒ½æœƒå°‡é€™äº› 2D ä½ç½®åˆ†é…çµ¦å‰ªè¼¯ç©ºé–“è¼¸å‡ºå…§åœ¨ gl_Positionã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šshaders/simple.frag</span><br><span class="line"></span><br><span class="line">out vec4 frag_color;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">  frag_color = vec4(0, 1, 0, 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‰‡æ®µè‘—è‰²å™¨ç”šè‡³æ›´ç°¡å–®ï¼›å®ƒè¼¸å‡ºä¸€å€‹ RGBA é¡è‰²ï¼Œç¯„åœç‚º (0, 0, 0, 0) åˆ° (1, 1, 1, 1)ã€‚å› æ­¤ï¼Œæ‰€æœ‰å…§å®¹éƒ½å°‡è¢«è‘—è‰²ç‚ºç¶ è‰²ã€‚</p>
<p>å¥½çš„ï¼Œç¾åœ¨æ‚¨æœ‰äº†è‘—è‰²å™¨ï¼Œè«‹ä½¿ç”¨ Flutter çš„æå‰ç·¨è­¯ (AOT) è‘—è‰²å™¨ç·¨è­¯å™¨å°‡å®ƒå€‘ç·¨è­¯ã€‚ç‚ºäº†ç‚ºè‘—è‰²å™¨æ†ç¶åŒ…è¨­å®šè‡ªå‹•åŒ–çš„å»ºç½®ï¼Œæˆ‘å€‘å»ºè­°æ‚¨ä½¿ç”¨ <a href="https://pub.dev/packages/flutter_gpu_shaders">flutter_gpu_shaders</a> å¥—ä»¶ã€‚</p>
<p>ä½¿ç”¨ pub å°‡ flutter_gpu_shaders ä½œç‚ºå°ˆæ¡ˆä¸­çš„å¸¸è¦ç›¸ä¾æ€§åŠ å…¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_gpu_shaders</span><br></pre></td></tr></table></figure>

<p>Flutter GPU è‘—è‰²å™¨æ†ç¶åˆ° .shaderbundle æª”æ¡ˆä¸­ï¼Œå¯ä»¥ä½œç‚ºå¸¸è¦è³‡ç”¢æ·»åŠ åˆ°å°ˆæ¡ˆçš„è³‡ç”¢æ†ç¶åŒ…ä¸­ã€‚è‘—è‰²å™¨æ†ç¶åŒ…åŒ…å«é‡å°å¹³å°ç›®æ¨™çš„ç·¨è­¯è‘—è‰²å™¨ä¾†æºã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œå»ºç«‹ä¸€å€‹è‘—è‰²å™¨æ†ç¶åŒ…å®£å‘Šæª”æ¡ˆï¼Œæè¿°è‘—è‰²å™¨æ†ç¶åŒ…çš„å…§å®¹ã€‚å°‡ä»¥ä¸‹å…§å®¹æ·»åŠ åˆ°å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸­çš„ my_renderer.shaderbundle.jsonã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;SimpleVertex&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;vertex&quot;,</span><br><span class="line">        &quot;file&quot;: &quot;shaders/simple.vert&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;SimpleFragment&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;fragment&quot;,</span><br><span class="line">        &quot;file&quot;: &quot;shaders/simple.frag&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‘—è‰²å™¨æ†ç¶åŒ…ä¸­çš„æ¯å€‹æ¢ç›®éƒ½å¯ä»¥å…·æœ‰ä»»æ„åç¨±ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œåç¨±æ˜¯ã€ŒSimpleVertexã€å’Œã€ŒSimpleFragmentã€ã€‚é€™äº›åç¨±ç”¨æ–¼åœ¨æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ä¸­æŸ¥æ‰¾è‘—è‰²å™¨ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œä½¿ç”¨ flutter_gpu_shaders å¥—ä»¶å»ºç½® shaderbundleã€‚æ‚¨å¯ä»¥é€éå•Ÿç”¨å¯¦é©—æ€§çš„ã€ŒåŸç”Ÿè³‡ç”¢ã€åŠŸèƒ½ä¾†æ–°å¢ä¸€å€‹æ›é‰¤ï¼Œè©²æ›é‰¤æœƒè‡ªå‹•è§¸ç™¼å»ºç½®ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¾†å•Ÿç”¨åŸç”Ÿè³‡ç”¢ä¸¦å®‰è£ native_assets_cli å¥—ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter config --enable-native-assets</span><br><span class="line">flutter pub add native_assets_cli</span><br></pre></td></tr></table></figure>

<p>å•Ÿç”¨åŸç”Ÿè³‡ç”¢åŠŸèƒ½å¾Œï¼Œåœ¨æ›é‰¤ç›®éŒ„ä¸‹æ–°å¢ä¸€å€‹ build.dart è„šæœ¬ï¼Œå®ƒå°‡è‡ªå‹•è§¸ç™¼å»ºç½®è‘—è‰²å™¨æ†ç¶åŒ…ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šhook/build.dart</span><br><span class="line"></span><br><span class="line">import &#x27;package:native_assets_cli/native_assets_cli.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_gpu_shaders/build.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main(List&lt;String&gt; args) async &#123;</span><br><span class="line">  await build(args, (config, output) async &#123;</span><br><span class="line">    await buildShaderBundleJson(</span><br><span class="line">        buildConfig: config,</span><br><span class="line">        buildOutput: output,</span><br><span class="line">        manifestFileName: &#x27;my_renderer.shaderbundle.json&#x27;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€²è¡Œæ­¤æ›´æ”¹å¾Œï¼Œç•¶ Flutter å·¥å…·å»ºç½®å°ˆæ¡ˆæ™‚ï¼ŒbuildShaderBundleJson å°‡å»ºç½®è‘—è‰²å™¨æ†ç¶åŒ…ï¼Œä¸¦å°‡çµæœè¼¸å‡ºåˆ°å¥—ä»¶æ ¹ç›®éŒ„ä¸‹çš„ build&#x2F;shaderbundles&#x2F;my_renderer.shaderbundleã€‚</p>
<p>è‘—è‰²å™¨æ†ç¶åŒ…æ ¼å¼æœ¬èº«èˆ‡æ‚¨ä½¿ç”¨çš„ Flutter ç‰¹å®šç‰ˆæœ¬ç¶å®šï¼Œä¸¦ä¸”å¯èƒ½æœƒéš¨è‘—æ™‚é–“æ¨ç§»è€Œæ”¹è®Šã€‚å¦‚æœæ‚¨æ­£åœ¨æ’°å¯«ä¸€å€‹å»ºç½®è‘—è‰²å™¨æ†ç¶åŒ…çš„å¥—ä»¶ï¼Œè«‹ä¸è¦å°‡ç”Ÿæˆçš„ .shaderbundle æª”æ¡ˆæª¢æŸ¥åˆ°æ‚¨çš„åŸå§‹ç¢¼æ¨¹ä¸­ã€‚ç›¸åï¼Œè«‹ä½¿ç”¨å»ºç½®æ›é‰¤ä¾†è‡ªå‹•åŒ–å»ºç½®æµç¨‹ï¼ˆå¦‚å‰æ‰€è¿°ï¼‰ã€‚</p>
<p>é€™æ¨£ä¸€ä¾†ï¼Œä½¿ç”¨æ‚¨å‡½å¼åº«çš„é–‹ç™¼äººå“¡å°‡å§‹çµ‚ä½¿ç”¨æ­£ç¢ºæ ¼å¼å»ºç½®æ–°çš„è‘—è‰²å™¨æ†ç¶åŒ…ï¼</p>
<p>ç¾åœ¨ï¼Œæ‚¨å·²ç¶“è‡ªå‹•åŒ–äº†è‘—è‰²å™¨æ†ç¶åŒ…çš„å»ºç½®ï¼Œè«‹åƒå¸¸è¦è³‡ç”¢ä¸€æ¨£åŒ¯å…¥å®ƒã€‚å°‡è³‡ç”¢æ¢ç›®æ·»åŠ åˆ°å°ˆæ¡ˆçš„ pubspec.yaml ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter:</span><br><span class="line">  assets:</span><br><span class="line">    - build/shaderbundles/</span><br></pre></td></tr></table></figure>

<p>åœ¨æœªä¾†ï¼ŒåŸç”Ÿè³‡ç”¢åŠŸèƒ½å°‡å…è¨±å»ºç½®æ›é‰¤å°‡è³‡æ–™è³‡ç”¢é™„åŠ åˆ°æ†ç¶åŒ…ä¸­ã€‚ä¸€æ—¦ç™¼ç”Ÿé€™ç¨®æƒ…æ³ï¼Œå°±ä¸éœ€è¦å†åœ¨å»ºç½®æ›é‰¤æ—é‚Šæ–°å¢è³‡ * * * * *ç”¢åŒ¯å…¥è¦å‰‡äº†ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œæ–°å¢ä¸€äº›ç¨‹å¼ç¢¼ï¼Œåœ¨åŸ·è¡Œæ™‚è¼‰å…¥è‘—è‰²å™¨ã€‚å»ºç«‹ lib&#x2F;shaders.dart ä¸¦æ–°å¢ä»¥ä¸‹ç¨‹å¼ç¢¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šlib/shaders.dart</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter_gpu/gpu.dart&#x27; as gpu;</span><br><span class="line"></span><br><span class="line">const String _kShaderBundlePath =</span><br><span class="line">    &#x27;build/shaderbundles/my_renderer.shaderbundle&#x27;;</span><br><span class="line">// æ³¨æ„ï¼šå¦‚æœæ‚¨æ­£åœ¨å»ºç«‹å‡½å¼åº«ï¼Œå‰‡è·¯å¾‘å¿…é ˆä»¥å¥—ä»¶åç¨±ç‚ºå‰ç¶´</span><br><span class="line">//      ä¾‹å¦‚ï¼š</span><br><span class="line">//      &#x27;packages/my_cool_renderer/build/shaderbundles/my_renderer.shaderbundle&#x27;</span><br><span class="line"></span><br><span class="line">gpu.ShaderLibrary? _shaderLibrary;</span><br><span class="line">gpu.ShaderLibrary get shaderLibrary &#123;</span><br><span class="line">  if (_shaderLibrary != null) &#123;</span><br><span class="line">    return _shaderLibrary!;</span><br><span class="line">  &#125;</span><br><span class="line">  _shaderLibrary = gpu.ShaderLibrary.fromAsset(_kShaderBundlePath);</span><br><span class="line">  if (_shaderLibrary != null) &#123;</span><br><span class="line">    return _shaderLibrary!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  throw Exception(&quot;Failed to load shader bundle! ($_kShaderBundlePath)&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤ç¨‹å¼ç¢¼ç‚º Flutter GPU è‘—è‰²å™¨åŸ·è¡Œæ™‚å‡½å¼åº«å»ºç«‹ä¸€å€‹å–®ä¾‹ getterã€‚ç¬¬ä¸€æ¬¡è¨ªå• shaderLibrary æ™‚ï¼Œæœƒä½¿ç”¨ gpu.ShaderLibrary.fromAsset(shader_bundle_path) ä½¿ç”¨å»ºç½®çš„è³‡ç”¢æ†ç¶åŒ…åˆå§‹åŒ–åŸ·è¡Œæ™‚è‘—è‰²å™¨å‡½å¼åº«ã€‚</p>
<p>å°ˆæ¡ˆç¾åœ¨å·²ç¶“è¨­å®šå¥½ä½¿ç”¨ Flutter GPU è‘—è‰²å™¨ã€‚æ˜¯æ™‚å€™æ¸²æŸ“é‚£å€‹ä¸‰è§’å½¢äº†ï¼</p>
<h3 id="ç»˜åˆ¶æ‚¨çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢"><a href="#ç»˜åˆ¶æ‚¨çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢" class="headerlink" title="ç»˜åˆ¶æ‚¨çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢"></a>ç»˜åˆ¶æ‚¨çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢</h3><p>å°æ–¼æœ¬æŒ‡å—ï¼Œæ‚¨å°‡å»ºç«‹ä¸€å€‹ RGBA Flutter GPU ç´‹ç†å’Œä¸€å€‹ RenderPassï¼Œå°‡ç´‹ç†ä½œç‚ºé¡è‰²è¼¸å‡ºé™„åŠ åˆ°å®ƒã€‚ç„¶å¾Œï¼Œæ‚¨å°‡ä½¿ç”¨ <a href="https://api.flutter.dev/flutter/dart-ui/Canvas/drawImage.html">Canvas.drawImage</a> åœ¨ Widget ä¸­æ¸²æŸ“ç´‹ç†ã€‚</p>
<p>ç‚ºäº†ç°¡æ½”èµ·è¦‹ï¼Œæ‚¨å°‡æ”¾æ£„æœ€ä½³å¯¦å‹™ï¼Œåªæœƒç‚ºæ¯ä¸€å¹€é‡æ–°å»ºç½®æ‰€æœ‰è³‡æºã€‚</p>
<p>åªè¦æ‚¨åœ¨åˆ†é…ç´‹ç†æ™‚å°‡å…¶æ¨™è¨˜ç‚ºã€Œè‘—è‰²å™¨å¯è®€å–ã€ï¼Œæ‚¨å°±å¯ä»¥å°‡å…¶è½‰æ›ç‚º dart:ui.Imageã€‚è‹¥è¦å°‡æ¸²æŸ“çµæœé¡¯ç¤ºåœ¨ Widget æ¨¹ä¸­ï¼Œè«‹å°‡å…¶ç¹ªè£½åˆ° dart:ui.Canvas ä¸Šï¼</p>
<p>æ‚¨å¯ä»¥é€éä½¿ç”¨è‡ªè¨‚ç•«å®¶ç‚º Widget æ¨¹æ¶è¨­è…³æ‰‹æ¶ä¾†å­˜å– Canvasã€‚å°‡ lib&#x2F;main.dart çš„å…§å®¹æ›¿æ›ç‚ºä»¥ä¸‹å…§å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:typed_data&#x27;;</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_gpu/gpu.dart&#x27; as gpu;</span><br><span class="line"></span><br><span class="line">// æ³¨æ„ï¼šæˆ‘å€‘ä¹‹å‰åœ¨è¨­å®šè‘—è‰²å™¨æ†ç¶åŒ…åŒ¯å…¥æ™‚å»ºç«‹äº†å®ƒ!</span><br><span class="line">import &#x27;shaders.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">  runApp(const MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  const MyApp(&#123;super.key&#125;);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return MaterialApp(</span><br><span class="line">      title: &#x27;Flutter GPU Triangle Example&#x27;,</span><br><span class="line">      home: CustomPaint(</span><br><span class="line">        painter: TrianglePainter(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TrianglePainter extends CustomPainter &#123;</span><br><span class="line">  @override</span><br><span class="line">  void paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    // å˜—è©¦å­˜å– `gpu.gpuContext`ã€‚</span><br><span class="line">    // å¦‚æœ Flutter GPU ä¸å—æ”¯æ´ï¼Œå°‡æœƒæ‹‹å‡ºç•°å¸¸ã€‚</span><br><span class="line">    print(&#x27;Default color format: &#x27; +</span><br><span class="line">        gpu.gpuContext.defaultColorFormat.toString());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool shouldRepaint(covariant CustomPainter oldDelegate) =&gt; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨ï¼ŒåŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ã€‚æé†’ä¸€ä¸‹ï¼ŒFlutter GPU ç›®å‰éœ€è¦ <a href="https://docs.flutter.dev/perf/impeller#availability">å•Ÿç”¨ Impeller</a>ã€‚å› æ­¤ï¼Œæ‚¨å¿…é ˆä½¿ç”¨ Impeller æ”¯æ´çš„å¹³å°ã€‚å°æ–¼æœ¬æŒ‡å—ï¼Œæˆ‘å°‡ä»¥ macOS ç‚ºç›®æ¨™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run -d macos --enable-impeller</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*lKTtaX2ih6dFpSMQ" />
</figure>

<p>å¦‚æœ Flutter GPU æ­£å¸¸å·¥ä½œï¼Œé‚£éº¼æ‚¨æ‡‰è©²æœƒçœ‹åˆ°é è¨­é¡è‰²æ ¼å¼è¢«åˆ—å°åˆ°ä¸»æ§å°ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter: Default color format: PixelFormat.b8g8r8a8UNormInt</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ Impeller æœªå•Ÿç”¨ï¼Œå‰‡åœ¨å˜—è©¦å­˜å– gpu.gpuContext æ™‚æœƒæ‹‹å‡ºç•°å¸¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception: Flutter GPU requires the Impeller rendering backend to be enabled.</span><br><span class="line"></span><br><span class="line">The relevant error-causing widget was:</span><br><span class="line">  CustomPaint</span><br></pre></td></tr></table></figure>

<p>ç‚ºäº†ç°¡ä¾¿èµ·è¦‹ï¼Œæ‚¨åªæœƒå¾é€™è£¡é–‹å§‹ä¿®æ”¹ paint æ–¹æ³•ã€‚</p>
<p>é¦–å…ˆï¼Œå»ºç«‹ä¸€å€‹ Flutter GPU ç´‹ç†ï¼Œæ¸…é™¤å®ƒï¼Œç„¶å¾Œé€éå°‡å…¶ç¹ªè£½åˆ° Canvas ä¸Šä¾†é¡¯ç¤ºå®ƒã€‚</p>
<p>å»ºç«‹ä¸€å€‹èˆ‡ Canvas å¤§å°ç›¸åŒçš„ç´‹ç†ã€‚å¿…é ˆé¸æ“‡ä¸€å€‹ <code>StorageMode</code>ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ‚¨å°‡ç´‹ç†æ¨™è¨˜ç‚º devicePrivateï¼Œå› ç‚ºæ‚¨å°‡åªä½¿ç”¨å¾è¨­å‚™ (GPU) å­˜å–ç´‹ç†è¨˜æ†¶é«”çš„æŒ‡ä»¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final texture = gpu.gpuContext.createTexture(gpu.StorageMode.devicePrivate,</span><br><span class="line">    size.width.toInt(), size.height.toInt())!;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé€éå¾ä¸»æ©Ÿ (CPU) ä¸Šå‚³è³‡æ–™ä¾†è¦†è“‹ç´‹ç†çš„è³‡æ–™ï¼Œå‰‡ä½¿ç”¨ <code>StorageMode.hostVisible</code>ã€‚</p>
<p>ç¬¬ä¸‰å€‹å¯ç”¨çš„é¸é …æ˜¯ <code>StorageMode.deviceTransient</code>ï¼Œå®ƒå°æ–¼ä¸éœ€è¦è¶…éå–®å€‹ RenderPass å£½å‘½çš„é™„ä»¶å¾ˆæœ‰ç”¨ï¼ˆå› æ­¤å®ƒå€‘å¯ä»¥åªå­˜åœ¨æ–¼ç“¦ç‰‡è¨˜æ†¶é«”ä¸­ï¼Œä¸¦ä¸”ä¸éœ€è¦ç”± VRAM åˆ†é…æ”¯æ´ï¼‰ã€‚é€šå¸¸ï¼Œæ·±åº¦&#x2F;æ¨¡æ¿ç´‹ç†ç¬¦åˆæ­¤æ¨™æº–ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œå®šç¾©ä¸€å€‹ <code>RenderTarget</code>ã€‚æ¸²æŸ“ç›®æ¨™åŒ…å«ä¸€çµ„ã€Œé™„ä»¶ã€ï¼Œæè¿°æ¯å€‹ç‰‡æ®µçš„è¨˜æ†¶é«”ä½ˆå±€åŠå…¶åœ¨ RenderPass é–‹å§‹å’ŒçµæŸæ™‚çš„è¨­å®š&#x2F;æ‹†å¸è¡Œç‚ºã€‚</p>
<p>æœ¬è³ªä¸Šï¼ŒRenderTarget æ˜¯ RenderPass çš„å¯é‡è¤‡ä½¿ç”¨æè¿°å™¨ã€‚</p>
<p>ç¾åœ¨ï¼Œå®šç¾©ä¸€å€‹éå¸¸ç°¡å–®çš„ <code>RenderTarget</code>ï¼Œå®ƒåªåŒ…å«ä¸€å€‹é¡è‰²é™„ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final renderTarget = gpu.RenderTarget.singleColor(</span><br><span class="line">gpu.ColorAttachment(texture: texture, clearValue: Colors.lightBlue));</span><br></pre></td></tr></table></figure>

<p>è«‹æ³¨æ„ï¼Œæ­¤ç¨‹å¼ç¢¼å°‡ clearValue è¨­å®šç‚ºæ·¡è—è‰²ã€‚æ¯å€‹é™„ä»¶éƒ½å…·æœ‰ <code>LoadAction</code> å’Œ <code>StoreAction</code>ï¼Œå®ƒå€‘åˆ†åˆ¥ç¢ºå®šåœ¨å‚³éçš„é–‹å§‹å’ŒçµæŸæ™‚æ‡‰è©²å°é™„ä»¶çš„è‡¨æ™‚ç“¦ç‰‡è¨˜æ†¶é«”åŸ·è¡Œä»€éº¼æ“ä½œã€‚</p>
<p>é è¨­æƒ…æ³ä¸‹ï¼Œé¡è‰²é™„ä»¶è¢«è¨­å®šç‚º <code>LoadAction.clear</code>ï¼ˆå®ƒå°‡ç“¦ç‰‡è¨˜æ†¶é«”åˆå§‹åŒ–ç‚ºçµ¦å®šçš„é¡è‰²ï¼‰å’Œ <code>StoreAction.store</code>ï¼ˆå®ƒå°‡çµæœå„²å­˜åˆ°é™„åŠ çš„ç´‹ç†çš„ VRAM åˆ†é…ä¸­ï¼‰ã€‚</p>
<p>ç¾åœ¨ï¼Œå»ºç«‹ä¸€å€‹ <code>CommandBuffer</code>ï¼Œä½¿ç”¨å‰é¢çš„ RenderTarget å¾å…¶ä¸­ç”¢ç”Ÿä¸€å€‹ RenderPassï¼Œç„¶å¾Œç«‹å³æäº¤ CommandBuffer ä»¥æ¸…é™¤ç´‹ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">final commandBuffer = gpu.gpuContext.createCommandBuffer();</span><br><span class="line">final renderPass = commandBuffer.createRenderPass(renderTarget);</span><br><span class="line">// ... ç¹ªè£½èª¿ç”¨å°‡æ”¾åœ¨é€™è£¡!</span><br><span class="line">commandBuffer.submit();</span><br></pre></td></tr></table></figure>

<p>å‰©ä¸‹çš„å°±æ˜¯å°‡åˆå§‹åŒ–çš„ç´‹ç†ç¹ªè£½åˆ° Canvas ä¸Šï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final image = texture.asImage();</span><br><span class="line">canvas.drawImage(image, Offset.zero, Paint());</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*ebUDtzQOuIGmdlop" />
</figure>

<p>ç¾åœ¨æ‚¨æœ‰äº†é€£æ¥åˆ°è¢å¹•é¡¯ç¤ºçµæœçš„ RenderPassï¼Œæ‚¨å°±å¯ä»¥é–‹å§‹ç¹ªè£½ä¸‰è§’å½¢äº†ã€‚è‹¥è¦åŸ·è¡Œæ­¤æ“ä½œï¼Œè«‹è¨­å®šä»¥ä¸‹å…§å®¹ï¼š</p>
<ol>
<li>å¾è‘—è‰²å™¨å»ºç«‹çš„ RenderPipelineï¼Œä»¥åŠ</li>
<li>åŒ…å«å¹¾ä½•å½¢ç‹€çš„ GPU å¯å­˜å–ç·©è¡å€ï¼ˆä¸‰å€‹é ‚é»ä½ç½®ï¼‰ã€‚</li>
</ol>
<p>å»ºç«‹ RenderPipeline å¾ˆå®¹æ˜“ã€‚æ‚¨åªéœ€å°‡å‡½å¼åº«ä¸­çš„é ‚é»å’Œç‰‡æ®µè‘—è‰²å™¨çµ„åˆåœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">final vert = shaderLibrary[&#x27;SimpleVertex&#x27;]!;</span><br><span class="line">final frag = shaderLibrary[&#x27;SimpleFragment&#x27;]!;</span><br><span class="line">final pipeline = gpu.gpuContext.createRenderPipeline(vert, frag);</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨æ˜¯å¹¾ä½•å½¢ç‹€ã€‚å›æƒ³ä¸€ä¸‹ï¼Œã€ŒSimpleVertexã€è‘—è‰²å™¨åªæœ‰ä¸€å€‹è¼¸å…¥ï¼š<code>in vec2 position</code>ã€‚å› æ­¤ï¼Œè‹¥è¦ç¹ªè£½ä¸‰å€‹é ‚é»ï¼Œæ‚¨éœ€è¦ä¸‰çµ„å…©å€‹æµ®é»æ•¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">final vertices = Float32List.fromList([</span><br><span class="line">  -0.5, -0.5, // ç¬¬ä¸€å€‹é ‚é»</span><br><span class="line">   0.5, -0.5, // ç¬¬äºŒå€‹é ‚é»</span><br><span class="line">   0.0,  0.5, // ç¬¬ä¸‰å€‹é ‚é»</span><br><span class="line">]);</span><br><span class="line">final verticesDeviceBuffer = gpu.gpuContext</span><br><span class="line">    .createDeviceBufferWithCopy(ByteData.sublistView(vertices))!;</span><br></pre></td></tr></table></figure>

<p>å‰©ä¸‹çš„å°±æ˜¯ç¹«çµæ–°çš„è³‡æºï¼Œä¸¦å‘¼å« renderPass.draw() ä»¥å®Œæˆè¨˜éŒ„ç¹ªè£½èª¿ç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">renderPass.bindPipeline(pipeline);</span><br><span class="line"></span><br><span class="line">final verticesView = gpu.BufferView(</span><br><span class="line">  verticesDeviceBuffer,</span><br><span class="line">  offsetInBytes: 0,</span><br><span class="line">  lengthInBytes: verticesDeviceBuffer.sizeInBytes,</span><br><span class="line">);</span><br><span class="line">renderPass.bindVertexBuffer(verticesView, 3);</span><br><span class="line"></span><br><span class="line">renderPass.draw();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ï¼Œæ‚¨ç¾åœ¨æ‡‰è©²æœƒçœ‹åˆ°ä¸€å€‹ç¶ è‰²çš„ä¸‰è§’å½¢ï¼</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*LWnGU5WPT_Eom0wJ" />
</figure>

<p>å¤ªæ£’äº†ï¼Œæ‚¨ä½¿ç”¨ Flutterã€Dart å’Œä¸€é» GLSL å¾é ­é–‹å§‹å»ºç«‹äº†ä¸€å€‹æ¸²æŸ“å™¨ï¼</p>
<p>ç„¡è«–é€™æ˜¯å¦æ˜¯æ‚¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸‰è§’å½¢ï¼Œæˆ–è€…æ‚¨æ˜¯ç¶“é©—è±å¯Œçš„åœ–å½¢å°ˆå®¶ï¼Œæˆ‘éƒ½å¸Œæœ›æ‚¨èƒ½ç¹¼çºŒä½¿ç”¨ Flutter GPUï¼Œä¸¦æŸ¥çœ‹æˆ‘å€‘æ­£åœ¨é–‹ç™¼çš„å¥—ä»¶ï¼Œä¾‹å¦‚ Flutter Sceneã€‚</p>
<p>åœ¨æœªä¾†ï¼Œæˆ‘å€‘å¸Œæœ›ç™¼ä½ˆå‹å¥½çš„åˆå­¸è€…ç¨‹å¼ç¢¼å¯¦é©—å®¤ï¼Œæ·±å…¥æ¢è¨ Flutter GPU çš„é è¨­è¡Œç‚ºå’Œæœ€ä½³å¯¦å‹™ã€‚æˆ‘å€‘é‚„æ²’è¨è«–é ‚é»å±¬æ€§ä½ˆå±€ã€ç´‹ç†ç¹«çµã€çµ±ä¸€å’Œå°é½Šè¦æ±‚ã€ç®¡é“æ··åˆã€æ·±åº¦å’Œæ¨¡æ¿é™„ä»¶ã€é€è¦–æ ¡æ­£ç­‰ç­‰ï¼</p>
<p>åœ¨é‚£ä¹‹å‰ï¼Œæˆ‘å»ºè­°æ‚¨æ¢ç´¢ <a href="https://github.com/bdero/flutter_scene">Flutter Scene</a> ä½œç‚ºå¦‚ä½•ä½¿ç”¨ Flutter GPU çš„æ›´å…¨é¢çš„ç¯„ä¾‹ã€‚</p>
<h3 id="ä½¿ç”¨-Flutter-Scene-é€²è¡Œ-3D-æ¸²æŸ“"><a href="#ä½¿ç”¨-Flutter-Scene-é€²è¡Œ-3D-æ¸²æŸ“" class="headerlink" title="ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“"></a>ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“</h3><p>Flutter Sceneï¼ˆå¥—ä»¶ flutter_sceneï¼‰æ˜¯ä¸€å€‹æ–°çš„ 3D å ´æ™¯åœ–å¥—ä»¶ï¼Œç”± Flutter GPU æ”¯æ´ï¼Œå®ƒä½¿ Flutter é–‹ç™¼äººå“¡èƒ½å¤ åŒ¯å…¥å‹•ç•« glTF æ¨¡å‹ä¸¦æ¸²æŸ“å³æ™‚ 3D å ´æ™¯ã€‚</p>
<p>ç›®çš„æ˜¯æä¾›ä¸€å€‹å¥—ä»¶ï¼Œè®“åœ¨ Flutter ä¸­è¼•é¬†å»ºç«‹äº’å‹•å¼ 3D æ‡‰ç”¨ç¨‹å¼å’ŒéŠæˆ²ã€‚</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*tC68CbPLef2rJp1e" />
</figure>

<p>è©²å¥—ä»¶æœ€åˆæ˜¯ä½œç‚ºä¸€å€‹ dart:ui æ“´å±•ï¼Œç”¨æ–¼ç”¨ C++ ç·¨å¯«çš„ 3D æ¸²æŸ“å™¨ï¼Œä¸¦ç›´æ¥å»ºç½®åˆ° Flutter çš„åŸç”ŸåŸ·è¡Œæ™‚ä¸­ï¼Œä½†å®ƒå·²ç¶“ä½¿ç”¨æ›´éˆæ´»çš„ä»‹é¢é‡å° Flutter GPU é‡æ–°æ’°å¯«ã€‚</p>
<p>èˆ‡ Flutter GPU API æœ¬èº«ä¸€æ¨£ï¼ŒFlutter Scene ç›®å‰è™•æ–¼æ—©æœŸé è¦½ç‹€æ…‹ï¼Œéœ€è¦ <a href="https://docs.flutter.dev/perf/impeller#availability">å•Ÿç”¨ Impeller</a>ã€‚Flutter Scene é€šå¸¸èˆ‡ Flutter GPU API çš„é‡å¤§è®Šæ›´ä¿æŒåŒæ­¥ï¼Œå› æ­¤å¼·çƒˆå»ºè­°æ‚¨åœ¨è©¦é©— Flutter Scene æ™‚ä½¿ç”¨ <a href="https://docs.flutter.dev/release/upgrade#other-channels">ä¸»é »é“</a>ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œä½¿ç”¨ Flutter Scene å»ºç«‹ä¸€å€‹æ‡‰ç”¨ç¨‹å¼ï¼</p>
<h3 id="è¨­å®š-Flutter-Scene-å°ˆæ¡ˆ"><a href="#è¨­å®š-Flutter-Scene-å°ˆæ¡ˆ" class="headerlink" title="è¨­å®š Flutter Scene å°ˆæ¡ˆ"></a>è¨­å®š Flutter Scene å°ˆæ¡ˆ</h3><p>ç”±æ–¼å¼·çƒˆå»ºè­°æ‚¨é‡å° <a href="https://docs.flutter.dev/release/upgrade#other-channels">ä¸»é »é“</a> ä½¿ç”¨ Flutter Sceneï¼Œè«‹å¾åˆ‡æ›åˆ°ä¸»é »é“é–‹å§‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter channel main</span><br><span class="line">flutter upgrade</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†ï¼Œå»ºç«‹ä¸€å€‹æ–°çš„ Flutter å°ˆæ¡ˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter create my_3d_app</span><br><span class="line">cd my_3d_app</span><br></pre></td></tr></table></figure>

<p>Flutter Scene ä¾é å¯¦é©—æ€§çš„ã€ŒåŸç”Ÿè³‡ç”¢ã€åŠŸèƒ½ä¾†è‡ªå‹•åŒ–è‘—è‰²å™¨çš„å»ºç½®ã€‚æ‚¨å°‡åœ¨ç¨å¾Œä½¿ç”¨åŸç”Ÿè³‡ç”¢ä¾†è¨­å®šè‡ªå‹•åŒ¯å…¥ Flutter Scene çš„ 3D æ¨¡å‹ã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å•Ÿç”¨åŸç”Ÿè³‡ç”¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter config --enable-native-assets</span><br></pre></td></tr></table></figure>

<p>æœ€å¾Œï¼Œå°‡ Flutter Scene æ·»åŠ ç‚ºå°ˆæ¡ˆç›¸ä¾æ€§ã€‚</p>
<p>æ‚¨é‚„éœ€è¦åœ¨èˆ‡ Flutter Scene çš„ API äº’å‹•æ™‚ä½¿ç”¨ä¸€äº› vector_math æ§‹é€ ï¼Œå› æ­¤ä¹Ÿæ·»åŠ  vector_math å¥—ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_scene vector_math</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†ï¼ŒåŒ¯å…¥ä¸€å€‹ 3D æ¨¡å‹ï¼</p>
<h3 id="åŒ¯å…¥-3D-æ¨¡å‹"><a href="#åŒ¯å…¥-3D-æ¨¡å‹" class="headerlink" title="åŒ¯å…¥ 3D æ¨¡å‹"></a>åŒ¯å…¥ 3D æ¨¡å‹</h3><p>é¦–å…ˆï¼Œæ‚¨éœ€è¦ä¸€å€‹è¦æ¸²æŸ“çš„ 3D æ¨¡å‹ã€‚å°æ–¼æœ¬æŒ‡å—ï¼Œæ‚¨å°‡ä½¿ç”¨å¸¸è¦‹çš„ <a href="https://en.wikipedia.org/wiki/GlTF">glTF</a> æ¨£æœ¬è³‡ç”¢ï¼š <a href="https://github.com/KhronosGroup/glTF-Sample-Assets/tree/main/Models/DamagedHelmet">DamagedHelmet.glb</a>ã€‚ä»¥ä¸‹æ˜¯å®ƒçš„æ¨£å­ã€‚</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/912/0*vVWRLxJ348tCxv7T" />
<figcaption>åŸå§‹çš„ Damaged Helmet æ¨¡å‹ç”± theblueturtle_ åœ¨ 2016 å¹´å»ºç«‹ï¼ˆæˆæ¬Šï¼š [CC BY-NC 4.0 åœ‹éš›](https://creativecommons.org/licenses/by-nc/4.0/legalcode)ï¼‰ã€‚è½‰æ›å¾Œçš„ glTF ç‰ˆæœ¬ç”± ctxwing åœ¨ 2018 å¹´å»ºç«‹ï¼ˆæˆæ¬Šï¼š [CC BY 4.0 åœ‹éš›](https://creativecommons.org/licenses/by/4.0/legalcode)ï¼‰ã€‚ </figcaption>
</figure>

<p>æ‚¨å¯ä»¥å¾ GitHub ä¸Šè¨—ç®¡çš„ <a href="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Assets/main/Models/DamagedHelmet/glTF-Binary/DamagedHelmet.glb">glTF æ¨£æœ¬è³‡ç”¢å„²å­˜åº«</a> ä¸­ç²å–å®ƒã€‚å°‡ DamagedHelmet.glb æ”¾ç½®åœ¨æ‚¨çš„å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/main/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb</span><br></pre></td></tr></table></figure>

<p>åƒå¤§å¤šæ•¸å³æ™‚ 3D æ¸²æŸ“å™¨ä¸€æ¨£ï¼ŒFlutter Scene åœ¨å…§éƒ¨ä½¿ç”¨å°ˆç”¨çš„ 3D æ¨¡å‹æ ¼å¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Flutter Scene çš„é›¢ç·šåŒ¯å…¥å™¨å·¥å…·å°‡æ¨™æº– glTF äºŒé€²åˆ¶æª”æ¡ˆï¼ˆ.glb æª”æ¡ˆï¼‰è½‰æ›ç‚ºæ­¤æ ¼å¼ã€‚</p>
<p>å°‡ flutter_scene_importer å¥—ä»¶ä½œç‚ºå¸¸è¦ç›¸ä¾æ€§æ·»åŠ åˆ°å°ˆæ¡ˆä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_scene_importer</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æ­¤å¥—ä»¶å¯ä»¥ä½¿ç”¨ dart run æ‰‹å‹•å‘¼å«åŒ¯å…¥å™¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dart --enable-experiment=native-assets \</span><br><span class="line">     run flutter_scene_importer:import \</span><br><span class="line">     --input &quot;path/to/my/source_model.glb&quot; \</span><br><span class="line">     --output &quot;path/to/my/imported_model.model&quot;</span><br></pre></td></tr></table></figure>

<p>æ‚¨å¯ä»¥é€éä½¿ç”¨åŸç”Ÿè³‡ç”¢å»ºç½®æ›é‰¤ä¾†è‡ªå‹•åŸ·è¡ŒåŒ¯å…¥å™¨ã€‚è‹¥è¦åŸ·è¡Œæ­¤æ“ä½œï¼Œè«‹å…ˆå°‡ native_assets_cli ä½œç‚ºå¸¸è¦å°ˆæ¡ˆç›¸ä¾æ€§å®‰è£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add native_assets_cli</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨æ‚¨å¯ä»¥æ’°å¯«å»ºç½®æ›é‰¤äº†ã€‚ä½¿ç”¨ä»¥ä¸‹å…§å®¹å»ºç«‹ hook&#x2F;build.dartã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;package:native_assets_cli/native_assets_cli.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene_importer/build_hooks.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main(List&lt;String&gt; args) &#123;</span><br><span class="line">  build(args, (config, output) async &#123;</span><br><span class="line">    buildModels(buildConfig: config, inputFilePaths: [</span><br><span class="line">      &#x27;DamagedHelmet.glb&#x27;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ flutter_scene_importer ä¸­çš„ buildModels å…¬ç”¨ç¨‹å¼ï¼Œæä¾›è¦å»ºç½®çš„æ¨¡å‹åˆ—è¡¨ã€‚è·¯å¾‘ç›¸å°æ–¼å°ˆæ¡ˆçš„å»ºç½®æ ¹ç›®éŒ„ã€‚</p>
<p>ç•¶ Flutter å·¥å…·å»ºç½®å°ˆæ¡ˆæ™‚ï¼ŒbuildModels ç¾åœ¨å°‡å»ºç½®è‘—è‰²å™¨æ†ç¶åŒ…ï¼Œä¸¦å°‡çµæœè¼¸å‡ºåˆ°å¥—ä»¶æ ¹ç›®éŒ„ä¸‹çš„ build&#x2F;models&#x2F;DamagedModel.modelã€‚</p>
<p>åŒ¯å…¥çš„æ¨¡å‹æ ¼å¼æœ¬èº«èˆ‡æ‚¨ä½¿ç”¨çš„ Flutter Scene ç‰¹å®šç‰ˆæœ¬ç¶å®šï¼Œä¸¦ä¸”æœƒéš¨è‘—æ™‚é–“æ¨ç§»è€Œæ”¹è®Šã€‚åœ¨æ’°å¯«ä½¿ç”¨ Flutter Scene çš„æ‡‰ç”¨ç¨‹å¼æˆ–å‡½å¼åº«æ™‚ï¼Œè«‹å‹¿å°‡ç”Ÿæˆçš„ .model æª”æ¡ˆæª¢æŸ¥åˆ°æ‚¨çš„åŸå§‹ç¢¼æ¨¹ä¸­ã€‚ç›¸åï¼Œè«‹ä½¿ç”¨å»ºç½®æ›é‰¤å¾æ‚¨çš„åŸå§‹æ¨¡å‹ä¸­ç”Ÿæˆå®ƒå€‘ï¼ˆå¦‚å‰æ‰€è¿°ï¼‰ã€‚</p>
<p>é€™æ¨£ä¸€ä¾†ï¼Œéš¨è‘—æ™‚é–“æ¨ç§»å‡ç´š Flutter Scene æ™‚ï¼Œæ‚¨å°‡å§‹çµ‚ä½¿ç”¨æ­£ç¢ºæ ¼å¼å»ºç½®æ–°çš„ .model æª”æ¡ˆï¼</p>
<p>æ¥ä¸‹ä¾†ï¼Œåƒå¸¸è¦è³‡ç”¢ä¸€æ¨£åŒ¯å…¥æ¨¡å‹ã€‚å°‡è³‡ç”¢æ¢ç›®æ·»åŠ åˆ°å°ˆæ¡ˆçš„ pubspec.yaml ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter:</span><br><span class="line">  assets:</span><br><span class="line">    - build/models/</span><br></pre></td></tr></table></figure>

<p>åœ¨æœªä¾†ï¼ŒåŸç”Ÿè³‡ç”¢åŠŸèƒ½å°‡å…è¨±å»ºç½®æ›é‰¤å°‡è³‡æ–™è³‡ç”¢é™„åŠ åˆ°æ†ç¶åŒ…ä¸­ã€‚ä¸€æ—¦ç™¼ç”Ÿé€™ç¨®æƒ…æ³ï¼Œå°±ä¸éœ€è¦å†åœ¨å»ºç½®æ›é‰¤æ—é‚Šæ–°å¢è³‡ç”¢åŒ¯å…¥è¦å‰‡äº†ã€‚</p>
<h3 id="æ¸²æŸ“-3D-å ´æ™¯"><a href="#æ¸²æŸ“-3D-å ´æ™¯" class="headerlink" title="æ¸²æŸ“ 3D å ´æ™¯"></a>æ¸²æŸ“ 3D å ´æ™¯</h3><p>ç¾åœ¨æ˜¯æ‡‰ç”¨ç¨‹å¼çš„ç¨‹å¼ç¢¼äº†ã€‚</p>
<p>é¦–å…ˆï¼Œå»ºç«‹ä¸€å€‹æœ‰ç‹€æ…‹çš„ Widgetï¼Œç”¨æ–¼åœ¨å¤šå€‹å¹€ä¸­ä¿ç•™ Sceneã€‚</p>
<p>æ‚¨å°‡æ ¹æ“šæ™‚é–“é€²è¡Œå‹•ç•«è™•ç†ï¼Œå› æ­¤å°‡ SingleTickerProviderStateMixin æ·»åŠ åˆ°ç‹€æ…‹ï¼Œä»¥åŠä¸€å€‹ elapsedSeconds æˆå“¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:math&#x27;;</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter/scheduler.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/camera.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/node.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/scene.dart&#x27;;</span><br><span class="line">import &#x27;package:vector_math/vector_math.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">  runApp(const MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyApp extends StatefulWidget&#123;</span><br><span class="line">  const MyApp(&#123;super.key&#125;);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  MyAppState createState() =&gt; MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyAppState extends State&lt;MyApp&gt; with SingleTickerProviderStateMixin &#123;</span><br><span class="line">  double elapsedSeconds = 0;</span><br><span class="line">  Scene scene = Scene();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return MaterialApp(</span><br><span class="line">      title: &#x27;My 3D app&#x27;,</span><br><span class="line">      home: Placeholder(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ä½œç‚ºå†’ç…™æ¸¬è©¦ï¼Œä»¥ç¢ºä¿æ²’æœ‰éŒ¯èª¤ã€‚è«‹è¨˜ä½è¦ <a href="https://docs.flutter.dev/perf/impeller#availability">å•Ÿç”¨ Impeller</a>ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run -d macos --enable-impeller</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/912/0*74qs6ytcTjyVHwML" />
</figure>

<p>åœ¨ç¹¼çºŒä¹‹å‰ï¼Œè«‹ç‚ºå‹•ç•«è¨­å®šè¨ˆæ™‚å™¨ã€‚è¦†è“‹ MyAppState ä¸­çš„ initState ä»¥å‘¼å« createTickerã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void initState() &#123;</span><br><span class="line">  createTicker((elapsed) &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      elapsedSeconds = elapsed.inMilliseconds.toDouble() / 1000;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).start();</span><br><span class="line">  </span><br><span class="line">  super.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦ Widget å¯è¦‹ï¼Œè¨ˆæ™‚å™¨å›å‘¼å°±æœƒç‚ºæ¯ä¸€å¹€è¢«å‘¼å«ã€‚å‘¼å« setState æœƒè§¸ç™¼æ­¤ Widget åœ¨æ¯ä¸€å¹€é‡å»ºã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œè¼‰å…¥ä¹‹å‰æ”¾ç½®åœ¨å°ˆæ¡ˆä¸­çš„ 3D æ¨¡å‹ï¼Œä¸¦å°‡å…¶æ·»åŠ åˆ° Scene ä¸­ã€‚</p>
<p>ä½¿ç”¨ Node.fromAsset å¾è³‡ç”¢æ†ç¶åŒ…ä¸­è¼‰å…¥æ¨¡å‹ã€‚å°‡ä»¥ä¸‹ç¨‹å¼ç¢¼æ”¾ç½®åœ¨ initState ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Node.fromAsset(&#x27;build/models/DamagedHelmet.model&#x27;).then((model) &#123;</span><br><span class="line">  model.name = &#x27;Helmet&#x27;;</span><br><span class="line">  scene.add(model);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Node.fromAsset æœƒç•°æ­¥åœ°å¾è³‡ç”¢æ†ç¶åŒ…ä¸­ååºåˆ—åŒ–æ¨¡å‹ï¼Œä¸¦åœ¨æ¨¡å‹æº–å‚™å¥½æ·»åŠ åˆ°å ´æ™¯ä¸­æ™‚è§£æè¿”å›çš„ Future<Node>ã€‚</p>
<p>ç¾åœ¨ï¼ŒMyAppState.initState æ‡‰è©²å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void initState() &#123;</span><br><span class="line">  createTicker((elapsed) &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      elapsedSeconds = elapsed.inMilliseconds.toDouble() / 1000;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).start();</span><br><span class="line">  </span><br><span class="line">  Node.fromAsset(&#x27;build/models/DamagedHelmet.model&#x27;).then((model) &#123;</span><br><span class="line">    model.name = &#x27;Helmet&#x27;;</span><br><span class="line">    scene.add(model);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  super.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œæ‚¨ä»ç„¶æ²’æœ‰å¯¦éš›æ¸²æŸ“ 3D Sceneï¼è‹¥è¦åŸ·è¡Œæ­¤æ“ä½œï¼Œè«‹ä½¿ç”¨ <code>Scene.render</code>ï¼Œå®ƒéœ€è¦ UI Canvasã€Flutter Scene Camera å’Œä¸€å€‹å¤§å°ã€‚</p>
<p>å­˜å– Canvas çš„ä¸€ç¨®æ–¹æ³•æ˜¯å»ºç«‹ä¸€å€‹ CustomPainterï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ScenePainter extends CustomPainter &#123;</span><br><span class="line">  ScenePainter(&#123;required this.scene, required this.camera&#125;);</span><br><span class="line">  Scene scene;</span><br><span class="line">  Camera camera;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    scene.render(camera, canvas, viewport: Offset.zero &amp; size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool shouldRepaint(covariant CustomPainter oldDelegate) =&gt; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è¦å¿˜è¨˜å°‡ shouldRepaint è¦†è“‹è¨­ç½®ç‚ºè¿”å› trueï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡é‡å»ºç™¼ç”Ÿæ™‚è‡ªè¨‚ç•«å®¶éƒ½æœƒé‡æ–°ç¹ªç•«ã€‚</p>
<p>æœ€å¾Œï¼Œå°‡ CustomPainter æ·»åŠ åˆ°æºæ¨¹ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  final painter = ScenePainter(</span><br><span class="line">    scene: scene,</span><br><span class="line">    camera: PerspectiveCamera(</span><br><span class="line">      position: Vector3(sin(elapsedSeconds) * 3, 2, cos(elapsedSeconds) * 3),</span><br><span class="line">      target: Vector3(0, 0, 0),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  return MaterialApp(</span><br><span class="line">    title: &#x27;My 3D app&#x27;,</span><br><span class="line">    home: CustomPaint(painter: painter),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤ç¨‹å¼ç¢¼æŒ‡ç¤ºç›¸æ©Ÿæ²¿è‘—ä¸€å€‹é€£çºŒçš„åœ“åœˆç§»å‹•ï¼Œä½†å§‹çµ‚é¢å‘åŸé»ã€‚</p>
<p>æœ€å¾Œï¼Œå•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run -d macos --enable-impeller</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/796/0*_-OFc0vhBHAhrPrO" />
</figure>

<p>ä»¥ä¸‹æ˜¯æˆ‘å€‘çµ„åˆçš„å®Œæ•´æºç¨‹å¼ç¢¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:math&#x27;;</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/camera.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/node.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/scene.dart&#x27;;</span><br><span class="line">import &#x27;package:vector_math/vector_math.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">  runApp(const MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyApp extends StatefulWidget &#123;</span><br><span class="line">  const MyApp(&#123;super.key&#125;);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  MyAppState createState() =&gt; MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyAppState extends State&lt;MyApp&gt; with SingleTickerProviderStateMixin &#123;</span><br><span class="line">  double elapsedSeconds = 0;</span><br><span class="line">  Scene scene = Scene();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void initState() &#123;</span><br><span class="line">    createTicker((elapsed) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        elapsedSeconds = elapsed.inMilliseconds.toDouble() / 1000;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;).start();</span><br><span class="line"></span><br><span class="line">    Node.fromAsset(&#x27;build/models/DamagedHelmet.model&#x27;).then((model) &#123;</span><br><span class="line">      model.name = &#x27;Helmet&#x27;;</span><br><span class="line">      scene.add(model);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    super.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    final painter = ScenePainter(</span><br><span class="line">      scene: scene,</span><br><span class="line">      camera: PerspectiveCamera(</span><br><span class="line">        position: Vector3(sin(elapsedSeconds) * 3, 2, cos(elapsedSeconds) * 3),</span><br><span class="line">        target: Vector3(0, 0, 0),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    return MaterialApp(</span><br><span class="line">      title: &#x27;My 3D app&#x27;,</span><br><span class="line">      home: CustomPaint(painter: painter),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ScenePainter extends CustomPainter &#123;</span><br><span class="line">  ScenePainter(&#123;required this.scene, required this.camera&#125;);</span><br><span class="line">  Scene scene;</span><br><span class="line">  Camera camera;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void paint(Canvas canvas, Size size) &#123;</span><br><span class="line">    scene.render(camera, canvas, viewport: Offset.zero &amp; size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool shouldRepaint(covariant CustomPainter oldDelegate) =&gt; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flutter-å…‰æ˜çš„æœªä¾†"><a href="#Flutter-å…‰æ˜çš„æœªä¾†" class="headerlink" title="Flutter å…‰æ˜çš„æœªä¾†"></a>Flutter å…‰æ˜çš„æœªä¾†</h3><p>å¦‚æœæ‚¨èƒ½å¤ æˆåŠŸåœ°éµå¾ªé€™äº›æŒ‡å—ä¸­çš„å…¶ä¸­ä¸€å€‹ä¸¦è®“å®ƒé‹è¡Œèµ·ä¾†ï¼šå¤ªæ£’äº†ï¼Œæ­å–œï¼</p>
<p>Flutter GPU å’Œ Flutter Scene éƒ½éå¸¸å¹´è¼•ï¼Œå¹³å°æ”¯æ´æœ‰é™ã€‚ä½†æˆ‘æƒ³ç¸½æœ‰ä¸€å¤©ï¼Œæˆ‘å€‘æœƒæ‡·å¿µé€™äº›ä¸èµ·çœ¼çš„é–‹ç«¯ã€‚</p>
<p>éš¨è‘— Impeller çš„æ¨å»£ï¼ŒFlutter åœ˜éšŠå®Œå…¨æŒæ§äº†æ¸²æŸ“å †ç–Šï¼Œå› ç‚ºæˆ‘ä»¬éœ€è¦é‡å° Flutter çš„ç”¨ä¾‹å°ˆé–€åŒ–æ¸²æŸ“å™¨ã€‚ç¾åœ¨ï¼Œæˆ‘å€‘æ­£åœ¨é–‹å•Ÿ Flutter æ­·å²ä¸Šçš„ä¸€å€‹æ–°ç¯‡ç« ã€‚ä¸€å€‹ç”±æ‚¨å…±åŒæŒæ§æ¸²æŸ“çš„ç¯‡ç« ï¼</p>
<p>Flutter Scene æœ€åˆæ˜¯ Impeller ä¸­çš„ C++ çµ„ä»¶ï¼Œèˆ‡ 2D Canvas æ¸²æŸ“å™¨ä¸€èµ·ï¼Œå¸¶æœ‰ä¸€å€‹ç²¾ç°¡çš„ dart:ui æ“´å±•ã€‚åœ¨æˆ‘æ§‹å»ºå®ƒæ™‚ï¼Œæˆ‘å·²ç¶“æ„è­˜åˆ° Flutter Engine ä¸æœƒæ˜¯å®ƒçš„æœ€çµ‚ç›®çš„åœ°ã€‚</p>
<p>3D æ¸²æŸ“å™¨çš„æ¶æ§‹æ±ºç­–æµ·æ´‹æ˜¯å»£é—Š</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/flutter/" rel="tag"># flutter</a>
              <a href="/tags/game-development/" rel="tag"># game-development</a>
              <a href="/tags/3d/" rel="tag"># 3d</a>
              <a href="/tags/guides-and-tutorials/" rel="tag"># guides-and-tutorials</a>
              <a href="/tags/graphics-programming/" rel="tag"># graphics-programming</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/807a2f46.html" rel="prev" title="ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU">
      <i class="fa fa-chevron-left"></i> ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/14c13b13.html" rel="next" title="ã€æ–‡ç« ç¿»è­¯ã€‘Announcing Dart 3.5, and an update on the Dart roadmap">
      ã€æ–‡ç« ç¿»è­¯ã€‘Announcing Dart 3.5, and an update on the Dart roadmap <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-Flutter-%E4%B8%AD%E5%BB%BA%E7%AB%8B%E8%87%AA%E8%A8%82%E6%B8%B2%E6%9F%93%E5%99%A8%E4%B8%A6%E6%B8%B2%E6%9F%93-3D-%E5%A0%B4%E6%99%AF%E3%80%82"><span class="nav-number">1.</span> <span class="nav-text">åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Flutter-GPU-%E5%85%A5%E9%96%80"><span class="nav-number">1.1.</span> <span class="nav-text">ä½¿ç”¨ Flutter GPU å…¥é–€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Flutter-GPU-%E5%85%A5%E9%96%80-1"><span class="nav-number">1.2.</span> <span class="nav-text">ä½¿ç”¨ Flutter GPU å…¥é–€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%87-Flutter-GPU-%E5%8A%A0%E5%85%A5%E6%82%A8%E7%9A%84%E5%B0%88%E6%A1%88"><span class="nav-number">1.3.</span> <span class="nav-text">å°‡ Flutter GPU åŠ å…¥æ‚¨çš„å°ˆæ¡ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E5%92%8C%E5%8C%AF%E5%85%A5%E8%91%97%E8%89%B2%E5%99%A8%E6%8D%86%E7%B6%81%E5%8C%85%E3%80%82"><span class="nav-number">1.4.</span> <span class="nav-text">å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%82%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E5%80%8B%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="nav-number">1.5.</span> <span class="nav-text">ç»˜åˆ¶æ‚¨çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Flutter-Scene-%E9%80%B2%E8%A1%8C-3D-%E6%B8%B2%E6%9F%93"><span class="nav-number">1.6.</span> <span class="nav-text">ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A-Flutter-Scene-%E5%B0%88%E6%A1%88"><span class="nav-number">1.7.</span> <span class="nav-text">è¨­å®š Flutter Scene å°ˆæ¡ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%AF%E5%85%A5-3D-%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.8.</span> <span class="nav-text">åŒ¯å…¥ 3D æ¨¡å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93-3D-%E5%A0%B4%E6%99%AF"><span class="nav-number">1.9.</span> <span class="nav-text">æ¸²æŸ“ 3D å ´æ™¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flutter-%E5%85%89%E6%98%8E%E7%9A%84%E6%9C%AA%E4%BE%86"><span class="nav-number">1.10.</span> <span class="nav-text">Flutter å…‰æ˜çš„æœªä¾†</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rainvisitor</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">170</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">184</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rainvisitor</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
