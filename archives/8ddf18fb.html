<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU | RainVisitor Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ã€æ–‡ç« å…§å®¹ä½¿ç”¨ Gemini 1.5 Pro è‡ªå‹•ç”¢ç”Ÿã€‘ åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚ Flutter 3.24 ç‰ˆæœ¬å¼•é€²äº†æ–°çš„ä½éšåœ–å½¢ APIï¼Œç¨±ç‚º Flutter GPUã€‚æ­¤å¤–ï¼Œé‚„æœ‰ä¸€å€‹ç”± Flutter GPU æ”¯æ´çš„ 3D æ¸²æŸ“å‡½å¼åº«ï¼Œç¨±ç‚º Flutter Scene (å¥—ä»¶ï¼šflutter_scene)ã€‚Flutter GPU å’Œ Flutter Scene">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU">
<meta property="og:url" content="https://blog.rainvisitor.me/archives/8ddf18fb.html">
<meta property="og:site_name" content="RainVisitor Blog">
<meta property="og:description" content="ã€æ–‡ç« å…§å®¹ä½¿ç”¨ Gemini 1.5 Pro è‡ªå‹•ç”¢ç”Ÿã€‘ åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚ Flutter 3.24 ç‰ˆæœ¬å¼•é€²äº†æ–°çš„ä½éšåœ–å½¢ APIï¼Œç¨±ç‚º Flutter GPUã€‚æ­¤å¤–ï¼Œé‚„æœ‰ä¸€å€‹ç”± Flutter GPU æ”¯æ´çš„ 3D æ¸²æŸ“å‡½å¼åº«ï¼Œç¨±ç‚º Flutter Scene (å¥—ä»¶ï¼šflutter_scene)ã€‚Flutter GPU å’Œ Flutter Scene">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/900/0*hAqIOVkaI1IWnOHE">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*JEI3fLDGcRHWKruT">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*lKTtaX2ih6dFpSMQ">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*ebUDtzQOuIGmdlop">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*LWnGU5WPT_Eom0wJ">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1024/0*tC68CbPLef2rJp1e">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/912/0*vVWRLxJ348tCxv7T">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/912/0*74qs6ytcTjyVHwML">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/796/0*_-OFc0vhBHAhrPrO">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/506/1*jfeUgpEP9AgAz94yVxVW1g.gif">
<meta property="article:published_time" content="2024-08-07T11:51:40.000Z">
<meta property="article:modified_time" content="2024-09-27T09:03:52.579Z">
<meta property="article:author" content="Rainvisitor">
<meta property="article:tag" content="Flutter">
<meta property="article:tag" content="GPU">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn-images-1.medium.com/max/900/0*hAqIOVkaI1IWnOHE">
  
    <link rel="alternate" href="/atom.xml" title="RainVisitor Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">RainVisitor Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.rainvisitor.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Getting-started-with-Flutter-GPU" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/archives/8ddf18fb.html" class="article-date">
  <time datetime="2024-08-07T11:51:40.000Z" itemprop="datePublished">2024-08-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Flutter/">Flutter</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ã€æ–‡ç« å…§å®¹ä½¿ç”¨ Gemini 1.5 Pro è‡ªå‹•ç”¢ç”Ÿã€‘</p>
<p>åœ¨ Flutter ä¸­å»ºç«‹è‡ªè¨‚æ¸²æŸ“å™¨ä¸¦æ¸²æŸ“ 3D å ´æ™¯ã€‚</p>
<p>Flutter 3.24 ç‰ˆæœ¬å¼•é€²äº†æ–°çš„ä½éšåœ–å½¢ APIï¼Œç¨±ç‚º Flutter GPUã€‚æ­¤å¤–ï¼Œé‚„æœ‰ä¸€å€‹ç”± Flutter GPU æ”¯æ´çš„ 3D æ¸²æŸ“å‡½å¼åº«ï¼Œç¨±ç‚º Flutter Scene (å¥—ä»¶ï¼šflutter_scene)ã€‚Flutter GPU å’Œ Flutter Scene ç›®å‰éƒ½è™•æ–¼é è¦½éšæ®µï¼Œåƒ…åœ¨ Flutter çš„ä¸»è¦é€šé“ä¸Šæä¾› (ç”±æ–¼ä¾è³´å¯¦é©—æ€§åŠŸèƒ½)ï¼Œéœ€è¦å•Ÿç”¨ Impellerï¼Œä¸¦ä¸”å¯èƒ½æœƒå¶çˆ¾å¼•å…¥é‡å¤§è®Šæ›´ã€‚</p>
<p>æœ¬æ–‡åŒ…å«é€™å…©å€‹å¥—ä»¶çš„å…©å€‹ã€Œå…¥é–€ã€æŒ‡å—ï¼š</p>
<ol>
<li><p>ğŸ”º <strong>é€²éšï¼š</strong>  Flutter GPU å…¥é–€<br>å¦‚æœä½ æ˜¯ç¶“é©—è±å¯Œçš„åœ–å½¢ç¨‹å¼è¨­è¨ˆå¸«ï¼Œæˆ–è€…ä½ å°ä½éšåœ–å½¢æ„Ÿèˆˆè¶£ï¼Œä¸¦å¸Œæœ›åœ¨ Flutter ä¸­å¾é ­é–‹å§‹å»ºç«‹æ¸²æŸ“å™¨ï¼Œé‚£éº¼æœ¬æŒ‡å—å°‡å¹«åŠ©ä½ é–‹å§‹ä½¿ç”¨ Flutter GPUã€‚ä½ å°‡å¾é ­é–‹å§‹ç¹ªè£½ä½ çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢â€¦â€¦åœ¨ Flutter ä¸­ï¼</p>
</li>
<li><p>ğŸ’š <strong>ä¸­ç´šï¼š</strong>  ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“<br>å¦‚æœä½ æ˜¯ä¸€ä½å¸Œæœ›å°‡ 3D åŠŸèƒ½æ·»åŠ åˆ°ä½ çš„æ‡‰ç”¨ç¨‹å¼ä¸­çš„ Flutter é–‹ç™¼äººå“¡ï¼Œæˆ–è€…ä½ å¸Œæœ›ä½¿ç”¨ Dart å’Œ Flutter å»ºç«‹ 3D éŠæˆ²ï¼Œé‚£éº¼æœ¬æŒ‡å—é©åˆä½ ï¼ä½ å°‡è¨­å®šä¸€å€‹åŒ¯å…¥ä¸¦åœ¨ Flutter ä¸­æ¸²æŸ“ 3D è³‡ç”¢çš„å°ˆæ¡ˆã€‚</p>
</li>
</ol>
<h3 id="Flutter-GPU-å…¥é–€"><a href="#Flutter-GPU-å…¥é–€" class="headerlink" title="Flutter GPU å…¥é–€"></a>Flutter GPU å…¥é–€</h3><p>âš ï¸ è­¦å‘Šï¼âš ï¸  Flutter GPU æœ¬è³ªä¸Šæ˜¯ä¸€å€‹ä½éš APIã€‚çµ•å¤§å¤šæ•¸å¾ Flutter GPU çš„å­˜åœ¨ä¸­å—ç›Šçš„ Flutter é–‹ç™¼äººå“¡ï¼Œå¾ˆå¯èƒ½æœƒé€šéä½¿ç”¨åœ¨ pub.dev ä¸Šç™¼å¸ƒçš„æ›´é«˜éšæ¸²æŸ“å‡½å¼åº« (ä¾‹å¦‚ Flutter Scene æ¸²æŸ“å¥—ä»¶) ä¾†å¯¦ç¾ã€‚å¦‚æœä½ å° Flutter GPU API æœ¬èº«ä¸æ„Ÿèˆˆè¶£ï¼Œä¸¦ä¸”åªå° 3D æ¸²æŸ“æ„Ÿèˆˆè¶£ï¼Œè«‹è·³è½‰åˆ°  ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“ã€‚</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/900/0*hAqIOVkaI1IWnOHE" />
<figcaption>é–ƒé–ƒç™¼å…‰ã€‚é€™æ˜¯ä¸€å€‹å°„ç·šè¡Œé€²çš„å¸¶ç¬¦è™Ÿè·é›¢å ´ã€‚ä½ å¯ä»¥ä½¿ç”¨ Flutter GPU æ¸²æŸ“å®ƒï¼Œä½†ä½¿ç”¨è‡ªè¨‚ç‰‡æ®µè‘—è‰²å™¨ä¹Ÿå¯ä»¥åšåˆ°ã€‚ </figcaption>
</figure>


<h3 id="Flutter-GPU-å…¥é–€-1"><a href="#Flutter-GPU-å…¥é–€-1" class="headerlink" title="Flutter GPU å…¥é–€"></a>Flutter GPU å…¥é–€</h3><p>Flutter GPU æ˜¯ Flutter å…§å»ºçš„ä½éšåœ–å½¢ APIã€‚å®ƒå…è¨±ä½ é€šéç·¨å¯« Dart ç¨‹å¼ç¢¼å’Œ GLSL è‘—è‰²å™¨åœ¨ Flutter ä¸­å»ºç«‹å’Œæ•´åˆè‡ªè¨‚æ¸²æŸ“å™¨ã€‚ä¸éœ€è¦åŸç”Ÿå¹³å°ç¨‹å¼ç¢¼ã€‚</p>
<p>ç›®å‰ï¼ŒFlutter GPU è™•æ–¼æ—©æœŸé è¦½éšæ®µï¼Œä¸¦æä¾›åŸºæœ¬çš„æŸµæ ¼åŒ– APIï¼Œä½†éš¨è‘— API æ¥è¿‘ç©©å®šç‹€æ…‹ï¼Œå°‡æœƒç¹¼çºŒæ·»åŠ å’Œæ”¹é€²æ›´å¤šåŠŸèƒ½ã€‚</p>
<p>Flutter GPU ä¹Ÿéœ€è¦å•Ÿç”¨ Impellerã€‚é€™æ„å‘³è‘—å®ƒåªèƒ½åœ¨ Impeller æ”¯æ´çš„å¹³å°ä¸Šä½¿ç”¨ã€‚åœ¨æ’°å¯«æœ¬æ–‡æ™‚ï¼ŒImpeller æ”¯æ´ï¼š</p>
<ul>
<li>iOS (é è¨­å•Ÿç”¨)</li>
<li>macOS (å¯é¸é è¦½)</li>
<li>Android (å¯é¸é è¦½)</li>
</ul>
<p>æˆ‘å€‘ä½¿ç”¨ Flutter GPU çš„ç›®æ¨™æ˜¯æœ€çµ‚æ”¯æ´æ‰€æœ‰ Flutter çš„å¹³å°ç›®æ¨™ã€‚æœ€çµ‚ç›®æ¨™æ˜¯åœ¨ Flutter ä¸­åŸ¹é¤Šè·¨å¹³å°æ¸²æŸ“è§£æ±ºæ–¹æ¡ˆçš„ç”Ÿæ…‹ç³»çµ±ï¼Œé€™äº›è§£æ±ºæ–¹æ¡ˆå°å¥—ä»¶ä½œè€…æ˜“æ–¼ç¶­è­·ï¼Œå°ä½¿ç”¨è€…æ˜“æ–¼å®‰è£ã€‚</p>
<p>3D æ¸²æŸ“åªæ˜¯ä¸€å€‹å¯èƒ½çš„ç”¨ä¾‹ã€‚Flutter GPU é‚„å¯ä»¥ç”¨æ–¼å»ºç«‹å°ˆé–€çš„ 2D æ¸²æŸ“å™¨ï¼Œæˆ–è€…åŸ·è¡Œæ›´ç‚ºéæ­£çµ±çš„æ“ä½œï¼Œä¾‹å¦‚æ¸²æŸ“ 4D ç©ºé–“çš„ 3D åˆ‡ç‰‡ï¼Œæˆ–è€…æŠ•å½±éæ­å¹¾é‡Œå¾—ç©ºé–“ã€‚</p>
<p>ä¸€å€‹ç”± Flutter GPU æ”¯æ´çš„è‡ªè¨‚ 2D æ¸²æŸ“å™¨çš„ä¸€å€‹å¾ˆå¥½çš„ç”¨ä¾‹ç¯„ä¾‹æ˜¯ä¾è³´éª¨éª¼ç¶²æ ¼è®Šå½¢çš„ 2D è§’è‰²å‹•ç•«æ ¼å¼ã€‚Spine 2D å°±æ˜¯ä¸€å€‹å¾ˆå¥½çš„ç¯„ä¾‹ã€‚é€™ç¨®éª¨éª¼ç¶²æ ¼è§£æ±ºæ–¹æ¡ˆé€šå¸¸å…·æœ‰å‹•ç•«ç‰‡æ®µï¼Œé€™äº›ç‰‡æ®µå¯ä»¥æ“ä½œå±¤æ¬¡çµæ§‹ä¸­éª¨éª¼çš„å¹³ç§»ã€æ—‹è½‰å’Œç¸®æ”¾å±¬æ€§ï¼Œä¸¦ä¸”æ¯å€‹é ‚é»éƒ½æœ‰å¹¾å€‹ç›¸é—œçš„ã€Œéª¨éª¼æ¬Šé‡ã€ï¼Œé€™äº›æ¬Šé‡æ±ºå®šå“ªäº›éª¨éª¼æ‡‰è©²å½±éŸ¿é ‚é»ä»¥åŠå½±éŸ¿ç¨‹åº¦ã€‚</p>
<p>ä½¿ç”¨ Canvas è§£æ±ºæ–¹æ¡ˆ (ä¾‹å¦‚ drawVertices)ï¼Œéœ€è¦åœ¨ CPU ä¸Šç‚ºæ¯å€‹é ‚é»æ‡‰ç”¨éª¨éª¼æ¬Šé‡è®Šæ›ã€‚ä½¿ç”¨ Flutter GPUï¼Œéª¨éª¼è®Šæ›å¯ä»¥ä»¥çµ±ä¸€é™£åˆ—çš„å½¢å¼å‚³éçµ¦é ‚é»è‘—è‰²å™¨ï¼Œç”šè‡³å¯ä»¥å‚³éçµ¦ç´‹ç†æ¡æ¨£å™¨ï¼Œå…è¨±æ ¹æ“šéª¨éª¼çš„ç‹€æ…‹å’Œæ¯å€‹é ‚é»çš„éª¨éª¼æ¬Šé‡ï¼Œåœ¨ GPU ä¸Šä¸¦è¡Œè¨ˆç®—æ¯å€‹é ‚é»çš„æœ€çµ‚ä½ç½®ã€‚</p>
<p>èªªåˆ°é€™è£¡ï¼Œè®“æˆ‘å€‘é€šéä¸€å€‹æº«å’Œçš„å…¥é–€ä¾†é–‹å§‹ä½¿ç”¨ Flutter GPUï¼šç¹ªè£½ä½ çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢ï¼</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*JEI3fLDGcRHWKruT" />
</figure>


<h3 id="å°‡-Flutter-GPU-æ·»åŠ åˆ°ä½ çš„å°ˆæ¡ˆä¸­"><a href="#å°‡-Flutter-GPU-æ·»åŠ åˆ°ä½ çš„å°ˆæ¡ˆä¸­" class="headerlink" title="å°‡ Flutter GPU æ·»åŠ åˆ°ä½ çš„å°ˆæ¡ˆä¸­"></a>å°‡ Flutter GPU æ·»åŠ åˆ°ä½ çš„å°ˆæ¡ˆä¸­</h3><p>é¦–å…ˆï¼Œè«‹æ³¨æ„ï¼ŒFlutter GPU ç›®å‰è™•æ–¼æ—©æœŸé è¦½éšæ®µï¼Œå¯èƒ½æœƒå‡ºç¾ API æ–·è£‚ã€‚ç›®å‰ API å·²ç¶“å¯ä»¥å¯¦ç¾å¾ˆå¤šåŠŸèƒ½ï¼Œä½†ç¶“é©—è±å¯Œçš„åœ–å½¢å·¥ç¨‹å¸«å¯èƒ½æœƒæ³¨æ„åˆ°ä¸€äº›ç¼ºå¤±çš„é€šç”¨åŠŸèƒ½ã€‚åœ¨æ¥ä¸‹ä¾†çš„å¹¾å€‹æœˆä¸­ï¼ŒFlutter GPU å°‡æœƒé€²è¡Œå¾ˆå¤šè¦åŠƒã€‚</p>
<p>å‡ºæ–¼é€™äº›åŸå› ï¼Œå¼·çƒˆå»ºè­°ä½ ç¾åœ¨é‡å° Flutter GPU é–‹ç™¼å¥—ä»¶æ™‚ï¼Œé‡å°  ä¸»è¦é€šé“  çš„é ‚ç«¯é€²è¡Œæ“ä½œã€‚å¦‚æœä½ é‡åˆ°ä»»ä½•æ„å¤–è¡Œç‚ºã€éŒ¯èª¤æˆ–åŠŸèƒ½è«‹æ±‚ï¼Œè«‹ä½¿ç”¨æ¨™æº–  Flutter éŒ¯èª¤ç¯„æœ¬  åœ¨ GitHub ä¸Šæäº¤éŒ¯èª¤ã€‚æ‰€æœ‰èˆ‡ Flutter GPU ç›¸é—œçš„è¿½è¹¤éŒ¯èª¤éƒ½å°‡æ¨™è¨˜ç‚º  flutter-gpu æ¨™ç±¤ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨å˜—è©¦ä½¿ç”¨ Flutter GPU ä¹‹å‰ï¼Œè«‹é€šéåŸ·è¡Œä»¥ä¸‹å‘½ä»¤å°‡ Flutter åˆ‡æ›åˆ°ä¸»è¦é€šé“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter channel main</span><br><span class="line">flutter upgrade</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨å»ºç«‹ä¸€å€‹æ–°çš„ Flutter å°ˆæ¡ˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter create my_cool_renderer</span><br><span class="line">cd my_cool_renderer</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†ï¼Œå°‡ flutter_gpu SDK å¥—ä»¶æ·»åŠ åˆ°ä½ çš„ pubspec ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_gpu --sdk=flutter</span><br></pre></td></tr></table></figure>


<h3 id="å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚"><a href="#å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚" class="headerlink" title="å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚"></a>å»ºç«‹å’ŒåŒ¯å…¥è‘—è‰²å™¨æ†ç¶åŒ…ã€‚</h3><p>ç‚ºäº†ä½¿ç”¨ Flutter GPU æ¸²æŸ“ä»»ä½•æ±è¥¿ï¼Œä½ éœ€è¦ç·¨å¯«ä¸€äº› GLSL è‘—è‰²å™¨ã€‚Flutter GPU çš„è‘—è‰²å™¨èˆ‡ Flutter çš„  ç‰‡æ®µè‘—è‰²å™¨  åŠŸèƒ½æ‰€æ¶ˆè€—çš„è‘—è‰²å™¨å…·æœ‰ä¸åŒçš„èªç¾©ï¼Œç‰¹åˆ¥æ˜¯åœ¨çµ±ä¸€ç¶å®šæ–¹é¢ã€‚ä½ é‚„éœ€è¦å®šç¾©ä¸€å€‹é ‚é»è‘—è‰²å™¨èˆ‡ç‰‡æ®µè‘—è‰²å™¨ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>å¾å®šç¾©æœ€ç°¡å–®çš„è‘—è‰²å™¨é–‹å§‹ã€‚ä½ å¯ä»¥å°‡è‘—è‰²å™¨æ”¾ç½®åœ¨å°ˆæ¡ˆä¸­çš„ä»»ä½•ä½ç½®ï¼Œä½†å°æ–¼æœ¬ç¯„ä¾‹ï¼Œè«‹å»ºç«‹ä¸€å€‹ shaders ç›®éŒ„ï¼Œä¸¦ç”¨å…©å€‹è‘—è‰²å™¨å¡«å……å®ƒï¼šsimple.vert å’Œ simple.fragã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šshaders/simple.vert</span><br><span class="line"></span><br><span class="line">in vec2 position;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"> gl_Position = vec4(position, 0.0, 1.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¹ªè£½ä¸‰è§’å½¢æ™‚ï¼Œä½ å°‡æ“æœ‰ä¸€ä»½æ•¸æ“šåˆ—è¡¨ï¼Œè©²åˆ—è¡¨å®šç¾©æ¯å€‹é ‚é»ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒåªåˆ—å‡ºäº† 2D ä½ç½®ã€‚å°æ–¼é€™äº›é ‚é»ä¸­çš„æ¯ä¸€å€‹ï¼Œç°¡å–®çš„é ‚é»è‘—è‰²å™¨å°‡é€™äº› 2D ä½ç½®åˆ†é…çµ¦å‰ªè¼¯ç©ºé–“è¼¸å‡ºå…§åœ¨ gl_Positionã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šshaders/simple.frag</span><br><span class="line"></span><br><span class="line">out vec4 frag_color;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"> frag_color = vec4(0, 1, 0, 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‰‡æ®µè‘—è‰²å™¨æ›´ç°¡å–®ï¼›å®ƒè¼¸å‡ºä¸€å€‹ RGBA é¡è‰²ï¼Œç¯„åœç‚º (0, 0, 0, 0) åˆ° (1, 1, 1, 1)ã€‚å› æ­¤ï¼Œæ‰€æœ‰å…§å®¹éƒ½å°‡è¢«é™°å½±ç‚ºç¶ è‰²ã€‚</p>
<p>å¥½äº†ï¼Œç¾åœ¨ä½ æœ‰äº†è‘—è‰²å™¨ï¼Œè«‹ä½¿ç”¨ Flutter çš„æå‰ (AOT) è‘—è‰²å™¨ç·¨è­¯å™¨ç·¨è­¯å®ƒå€‘ã€‚ç‚ºäº†è¨­å®šè‘—è‰²å™¨æ†ç¶åŒ…çš„è‡ªå‹•åŒ–æ§‹å»ºï¼Œæˆ‘å€‘å»ºè­°ä½¿ç”¨  flutter_gpu_shaders  å¥—ä»¶ã€‚</p>
<p>ä½¿ç”¨ pub å°‡ flutter_gpu_shaders ä½œç‚ºä½ çš„å°ˆæ¡ˆä¸­çš„å¸¸è¦ä¾è³´é …æ·»åŠ ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_gpu_shaders</span><br></pre></td></tr></table></figure>

<p>Flutter GPU è‘—è‰²å™¨è¢«æ†ç¶åˆ° .shaderbundle æ–‡ä»¶ä¸­ï¼Œé€™äº›æ–‡ä»¶å¯ä»¥ä½œç‚ºå¸¸è¦è³‡ç”¢æ·»åŠ åˆ°ä½ çš„å°ˆæ¡ˆçš„è³‡ç”¢æ†ç¶åŒ…ä¸­ã€‚è‘—è‰²å™¨æ†ç¶åŒ…åŒ…å«é‡å°å¹³å°ç›®æ¨™çš„ç·¨è­¯å¾Œçš„è‘—è‰²å™¨æºç¨‹å¼ç¢¼ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œå»ºç«‹ä¸€å€‹è‘—è‰²å™¨æ†ç¶åŒ…æ¸…å–®æ–‡ä»¶ï¼Œè©²æ–‡ä»¶æè¿°è‘—è‰²å™¨æ†ç¶åŒ…çš„å…§å®¹ã€‚å°‡ä»¥ä¸‹å…§å®¹æ·»åŠ åˆ°å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸­çš„ my_renderer.shaderbundle.json ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;SimpleVertex&quot;: &#123;</span><br><span class="line"> &quot;type&quot;: &quot;vertex&quot;,</span><br><span class="line"> &quot;file&quot;: &quot;shaders/simple.vert&quot;</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;SimpleFragment&quot;: &#123;</span><br><span class="line"> &quot;type&quot;: &quot;fragment&quot;,</span><br><span class="line"> &quot;file&quot;: &quot;shaders/simple.frag&quot;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‘—è‰²å™¨æ†ç¶åŒ…ä¸­çš„æ¯å€‹æ¢ç›®éƒ½å¯ä»¥å…·æœ‰ä»»æ„çš„åç¨±ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œåç¨±ç‚ºã€ŒSimpleVertexã€å’Œã€ŒSimpleFragmentã€ã€‚é€™äº›åç¨±ç”¨æ–¼åœ¨ä½ çš„æ‡‰ç”¨ç¨‹å¼ä¸­æŸ¥æ‰¾è‘—è‰²å™¨ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œä½¿ç”¨ flutter_gpu_shaders å¥—ä»¶æ§‹å»º shaderbundleã€‚ä½ å¯ä»¥é€šéå•Ÿç”¨å¯¦é©—æ€§çš„ã€ŒåŸç”Ÿè³‡ç”¢ã€åŠŸèƒ½ä¾†æ·»åŠ ä¸€å€‹è‡ªå‹•è§¸ç™¼æ§‹å»ºçš„é‰¤å­ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¾†å•Ÿç”¨åŸç”Ÿè³‡ç”¢ä¸¦å®‰è£ native_assets_cli å¥—ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter config --enable-native-assets</span><br><span class="line">flutter pub add native_assets_cli</span><br></pre></td></tr></table></figure>

<p>å•Ÿç”¨åŸç”Ÿè³‡ç”¢åŠŸèƒ½å¾Œï¼Œåœ¨ hook ç›®éŒ„ä¸‹æ·»åŠ ä¸€å€‹ build.dart è…³æœ¬ï¼Œå®ƒå°‡è‡ªå‹•è§¸ç™¼æ§‹å»ºè‘—è‰²å™¨æ†ç¶åŒ…ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šhook/build.dart</span><br><span class="line"></span><br><span class="line">import &#x27;package:native_assets_cli/native_assets_cli.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_gpu_shaders/build.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main(List&lt;String&gt; args) async &#123;</span><br><span class="line"> await build(args, (config, output) async &#123;</span><br><span class="line"> await buildShaderBundleJson(</span><br><span class="line"> buildConfig: config,</span><br><span class="line"> buildOutput: output,</span><br><span class="line"> manifestFileName: &#x27;my_renderer.shaderbundle.json&#x27;</span><br><span class="line"> );</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€²è¡Œæ­¤æ›´æ”¹å¾Œï¼Œç•¶ Flutter å·¥å…·æ§‹å»ºå°ˆæ¡ˆæ™‚ï¼ŒbuildShaderBundleJson å°‡æ§‹å»ºè‘—è‰²å™¨æ†ç¶åŒ…ï¼Œä¸¦å°‡çµæœè¼¸å‡ºåˆ°å¥—ä»¶æ ¹ç›®éŒ„ä¸‹çš„ build&#x2F;shaderbundles&#x2F;my_renderer.shaderbundleã€‚</p>
<p>è‘—è‰²å™¨æ†ç¶åŒ…æ ¼å¼æœ¬èº«èˆ‡ä½ ä½¿ç”¨çš„ Flutter ç‰¹å®šç‰ˆæœ¬ç›¸é—œè¯ï¼Œä¸¦ä¸”å¯èƒ½æœƒéš¨è‘—æ™‚é–“çš„æ¨ç§»è€Œæ›´æ”¹ã€‚å¦‚æœä½ æ­£åœ¨ç·¨å¯«ä¸€å€‹æ§‹å»ºè‘—è‰²å™¨æ†ç¶åŒ…çš„å¥—ä»¶ï¼Œè«‹ä¸è¦å°‡ç”Ÿæˆçš„ .shaderbundle æ–‡ä»¶æª¢æŸ¥åˆ°ä½ çš„æºç¨‹å¼ç¢¼æ¨¹ä¸­ã€‚ç›¸åï¼Œè«‹ä½¿ç”¨æ§‹å»ºé‰¤å­è‡ªå‹•åŒ–æ§‹å»ºéç¨‹ (å¦‚å‰æ‰€è¿°)ã€‚</p>
<p>é€™æ¨£ä¸€ä¾†ï¼Œä½¿ç”¨ä½ çš„å‡½å¼åº«çš„é–‹ç™¼äººå“¡å°‡å§‹çµ‚ä½¿ç”¨æ­£ç¢ºæ ¼å¼æ§‹å»ºæ–°çš„è‘—è‰²å™¨æ†ç¶åŒ…ï¼</p>
<p>ç¾åœ¨ä½ å·²ç¶“è‡ªå‹•æ§‹å»ºäº†è‘—è‰²å™¨æ†ç¶åŒ…ï¼Œè«‹åƒåŒ¯å…¥å¸¸è¦è³‡ç”¢ä¸€æ¨£åŒ¯å…¥å®ƒã€‚åœ¨ä½ çš„å°ˆæ¡ˆçš„ pubspec.yaml ä¸­æ·»åŠ ä¸€å€‹è³‡ç”¢æ¢ç›®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter:</span><br><span class="line"> assets:</span><br><span class="line"> - build/shaderbundles/</span><br></pre></td></tr></table></figure>

<p>å°‡ä¾†ï¼ŒåŸç”Ÿè³‡ç”¢åŠŸèƒ½å°‡å…è¨±æ§‹å»ºé‰¤å­å°‡æ•¸æ“šè³‡ç”¢é™„åŠ åˆ°æ†ç¶åŒ…ä¸­ã€‚ä¸€æ—¦ç™¼ç”Ÿé€™ç¨®æƒ…æ³ï¼Œå°±ä¸å†éœ€è¦æ·»åŠ è³‡ç”¢åŒ¯å…¥è¦å‰‡ä»¥åŠæ§‹å»ºé‰¤å­ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œæ·»åŠ ä¸€äº›ç¨‹å¼ç¢¼åœ¨åŸ·è¡Œæ™‚è¼‰å…¥è‘—è‰²å™¨ã€‚å»ºç«‹ lib&#x2F;shaders.dart ä¸¦æ·»åŠ ä»¥ä¸‹ç¨‹å¼ç¢¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// è¤‡è£½åˆ°ï¼šlib/shaders.dart</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter_gpu/gpu.dart&#x27; as gpu;</span><br><span class="line"></span><br><span class="line">const String _kShaderBundlePath =</span><br><span class="line"> &#x27;build/shaderbundles/my_renderer.shaderbundle&#x27;;</span><br><span class="line">// æ³¨æ„ï¼šå¦‚æœä½ æ­£åœ¨æ§‹å»ºä¸€å€‹å‡½å¼åº«ï¼Œå‰‡è·¯å¾‘å¿…é ˆä»¥å¥—ä»¶åç¨±ç‚ºå‰ç¶´ã€‚ä¾‹å¦‚ï¼š</span><br><span class="line">// &#x27;packages/my_cool_renderer/build/shaderbundles/my_renderer.shaderbundle&#x27;</span><br><span class="line"></span><br><span class="line">gpu.ShaderLibrary? _shaderLibrary;</span><br><span class="line">gpu.ShaderLibrary get shaderLibrary &#123;</span><br><span class="line"> if (_shaderLibrary != null) &#123;</span><br><span class="line"> return _shaderLibrary!;</span><br><span class="line"> &#125;</span><br><span class="line"> _shaderLibrary = gpu.ShaderLibrary.fromAsset(_kShaderBundlePath);</span><br><span class="line"> if (_shaderLibrary != null) &#123;</span><br><span class="line"> return _shaderLibrary!;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> throw Exception(&quot;Failed to load shader bundle! ($_kShaderBundlePath)&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™æ®µç¨‹å¼ç¢¼ç‚º Flutter GPU è‘—è‰²å™¨åŸ·è¡Œæ™‚å‡½å¼åº«å»ºç«‹äº†ä¸€å€‹å–®ä¾‹ç²å–å™¨ã€‚ç¬¬ä¸€æ¬¡è¨ªå• shaderLibrary æ™‚ï¼Œå°‡ä½¿ç”¨ gpu.ShaderLibrary.fromAsset(shader_bundle_path) ä½¿ç”¨æ§‹å»ºçš„è³‡ç”¢æ†ç¶åŒ…åˆå§‹åŒ–åŸ·è¡Œæ™‚è‘—è‰²å™¨å‡½å¼åº«ã€‚</p>
<p>ç¾åœ¨å°ˆæ¡ˆå·²ç¶“è¨­å®šå¥½äº†ï¼Œå¯ä»¥ä½¿ç”¨ Flutter GPU è‘—è‰²å™¨ã€‚æ˜¯æ™‚å€™æ¸²æŸ“é‚£å€‹ä¸‰è§’å½¢äº†ï¼</p>
<h3 id="ç¹ªè£½ä½ çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢"><a href="#ç¹ªè£½ä½ çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢" class="headerlink" title="ç¹ªè£½ä½ çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢"></a>ç¹ªè£½ä½ çš„ç¬¬ä¸€å€‹ä¸‰è§’å½¢</h3><p>åœ¨æœ¬æŒ‡å—ä¸­ï¼Œä½ å°‡å»ºç«‹ä¸€å€‹ RGBA Flutter GPU ç´‹ç†å’Œä¸€å€‹æ¸²æŸ“é€šé“ï¼Œå°‡ç´‹ç†é™„åŠ ç‚ºé¡è‰²è¼¸å‡ºã€‚ç„¶å¾Œï¼Œä½ å°‡ä½¿ç”¨  Canvas.drawImage  åœ¨å°éƒ¨ä»¶ä¸­æ¸²æŸ“ç´‹ç†ã€‚</p>
<p>ç‚ºäº†ç°¡æ½”èµ·è¦‹ï¼Œä½ å°‡æ”¾æ£„æœ€ä½³å¯¦è¸ï¼Œä¸¦åƒ…ç‚ºæ¯å€‹å¹€é‡å»ºæ‰€æœ‰è³‡æºã€‚</p>
<p>åªè¦åœ¨åˆ†é…ç´‹ç†æ™‚å°‡å…¶æ¨™è¨˜ç‚ºã€Œè‘—è‰²å™¨å¯è®€ã€ï¼Œä½ å°±å¯ä»¥å°‡å…¶è½‰æ›ç‚º dart:ui.Imageã€‚è¦å°‡æ¸²æŸ“çµæœé¡¯ç¤ºåœ¨å°éƒ¨ä»¶æ¨¹ä¸­ï¼Œè«‹å°‡å…¶ç¹ªè£½åˆ° dart:ui.Canvas ä¸­ï¼</p>
<p>ä½ å¯ä»¥é€šéä½¿ç”¨è‡ªè¨‚ç¹ªè£½å™¨æ­å»ºå°éƒ¨ä»¶æ¨¹ä¾†è¨ªå• Canvasã€‚å°‡ lib&#x2F;main.dart çš„å…§å®¹æ›¿æ›ç‚ºä»¥ä¸‹å…§å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:typed_data&#x27;;</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_gpu/gpu.dart&#x27; as gpu;</span><br><span class="line"></span><br><span class="line">// æ³¨æ„ï¼šæˆ‘å€‘ä¹‹å‰åœ¨è¨­å®šè‘—è‰²å™¨æ†ç¶åŒ…åŒ¯å…¥æ™‚å‰µå»ºäº†é€™å€‹ï¼</span><br><span class="line">import &#x27;shaders.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"> runApp(const MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line"> const MyApp(&#123;super.key&#125;);</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> Widget build(BuildContext context) &#123;</span><br><span class="line"> return MaterialApp(</span><br><span class="line"> title: &#x27;Flutter GPU Triangle Example&#x27;,</span><br><span class="line"> home: CustomPaint(</span><br><span class="line"> painter: TrianglePainter(),</span><br><span class="line"> ),</span><br><span class="line"> );</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TrianglePainter extends CustomPainter &#123;</span><br><span class="line"> @override</span><br><span class="line"> void paint(Canvas canvas, Size size) &#123;</span><br><span class="line"> // å˜—è©¦è¨ªå• `gpu.gpuContext`ã€‚</span><br><span class="line"> // å¦‚æœ Flutter GPU ä¸å—æ”¯æ´ï¼Œå‰‡å°‡æ‹‹å‡ºç•°å¸¸ã€‚</span><br><span class="line"> print(&#x27;Default color format: &#x27; +</span><br><span class="line"> gpu.gpuContext.defaultColorFormat.toString());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> bool shouldRepaint(covariant CustomPainter oldDelegate) =&gt; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨ï¼ŒåŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ã€‚è«‹æé†’ä¸€ä¸‹ï¼ŒFlutter GPU ç›®å‰éœ€è¦å•Ÿç”¨ Impellerã€‚å› æ­¤ä½ å¿…é ˆä½¿ç”¨ Impeller æ”¯æ´çš„å¹³å°ã€‚åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°‡é‡å° macOSã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run -d macos --enable-impeller</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*lKTtaX2ih6dFpSMQ" />
</figure>

<p>å¦‚æœ Flutter GPU æ­£åœ¨é‹ä½œï¼Œé‚£éº¼ä½ æ‡‰è©²æœƒçœ‹åˆ°é è¨­é¡è‰²æ ¼å¼è¢«åˆ—å°åˆ°æ§åˆ¶å°ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter: Default color format: PixelFormat.b8g8r8a8UNormInt</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ Impeller æœªå•Ÿç”¨ï¼Œå‰‡åœ¨å˜—è©¦è¨ªå• gpu.gpuContext æ™‚å°‡æ‹‹å‡ºç•°å¸¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception: Flutter GPU requires the Impeller rendering backend to be enabled.</span><br><span class="line"></span><br><span class="line">The relevant error-causing widget was:</span><br><span class="line"> CustomPaint</span><br></pre></td></tr></table></figure>

<p>ç‚ºäº†ç°¡å–®èµ·è¦‹ï¼Œä½ åªæœƒå¾é€™è£¡é–‹å§‹ä¿®æ”¹ paint æ–¹æ³•ã€‚</p>
<p>é¦–å…ˆï¼Œå»ºç«‹ä¸€å€‹ Flutter GPU ç´‹ç†ï¼Œæ¸…é™¤å®ƒï¼Œç„¶å¾Œé€šéå°‡å…¶ç¹ªè£½åˆ° Canvas ä¸­ä¾†é¡¯ç¤ºå®ƒã€‚</p>
<p>å»ºç«‹ä¸€å€‹èˆ‡ Canvas å¤§å°ç›¸åŒçš„ç´‹ç†ã€‚å¿…é ˆé¸æ“‡ä¸€å€‹å„²å­˜æ¨¡å¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä½ å°‡ç´‹ç†æ¨™è¨˜ç‚º devicePrivateï¼Œå› ç‚ºä½ åªæœƒä½¿ç”¨å¾è£ç½® (GPU) è¨ªå•ç´‹ç†è¨˜æ†¶é«”çš„æŒ‡ä»¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final texture = gpu.gpuContext.createTexture(gpu.StorageMode.devicePrivate,</span><br><span class="line"> size.width.toInt(), size.height.toInt())!;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé€šéå¾ä¸»æ©Ÿ (CPU) ä¸Šè¼‰ç´‹ç†çš„æ•¸æ“šä¾†è¦†è“‹ç´‹ç†çš„æ•¸æ“šï¼Œé‚£éº¼è«‹æ”¹ç”¨ StorageMode.hostVisibleã€‚</p>
<p>ç¬¬ä¸‰å€‹å¯ç”¨çš„é¸é …æ˜¯ StorageMode.deviceTransientï¼Œå®ƒé©ç”¨æ–¼ä¸éœ€è¦è¶…éå–®å€‹æ¸²æŸ“é€šé“çš„å£½å‘½çš„é™„ä»¶ (å› æ­¤å®ƒå€‘å¯ä»¥åªå­˜åœ¨æ–¼ç£ç£šè¨˜æ†¶é«”ä¸­ï¼Œä¸¦ä¸”ä¸éœ€è¦ç”± VRAM åˆ†é…æ”¯æ´)ã€‚å¾ˆå¤šæ™‚å€™ï¼Œæ·±åº¦&#x2F;æ¨¡æ¿ç´‹ç†ç¬¦åˆé€™å€‹æ¨™æº–ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œå®šç¾©ä¸€å€‹ RenderTargetã€‚æ¸²æŸ“ç›®æ¨™åŒ…å«ä¸€å€‹ã€Œé™„ä»¶ã€é›†åˆï¼Œé€™äº›é™„ä»¶æè¿°äº†æ¯å€‹ç‰‡æ®µè¨˜æ†¶é«”ä½ˆå±€åŠå…¶åœ¨æ¸²æŸ“é€šé“é–‹å§‹å’ŒçµæŸæ™‚çš„è¨­ç½®&#x2F;æ‹†å¸è¡Œç‚ºã€‚</p>
<p>æœ¬è³ªä¸Šï¼Œæ¸²æŸ“ç›®æ¨™æ˜¯æ¸²æŸ“é€šé“çš„å¯é‡è¤‡ä½¿ç”¨æè¿°ç¬¦ã€‚</p>
<p>ç¾åœ¨ï¼Œå®šç¾©ä¸€å€‹ç”±ä¸€å€‹é¡è‰²é™„ä»¶çµ„æˆçš„éå¸¸ç°¡å–®çš„æ¸²æŸ“ç›®æ¨™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final renderTarget = gpu.RenderTarget.singleColor(</span><br><span class="line"> gpu.ColorAttachment(texture: texture, clearValue: Colors.lightBlue));</span><br></pre></td></tr></table></figure>

<p>è«‹æ³¨æ„ï¼Œé€™æ®µç¨‹å¼ç¢¼å°‡ clearValue è¨­ç½®ç‚ºæ·ºè—è‰²ã€‚æ¯å€‹é™„ä»¶éƒ½æœ‰ä¸€å€‹ LoadAction å’Œä¸€å€‹ StoreActionï¼Œå®ƒå€‘åˆ†åˆ¥æ±ºå®šåœ¨é€šé“é–‹å§‹å’ŒçµæŸæ™‚æ‡‰è©²å°é™„ä»¶çš„è‡¨æ™‚ç£ç£šè¨˜æ†¶é«”åŸ·è¡Œä»€éº¼æ“ä½œã€‚</p>
<p>é è¨­æƒ…æ³ä¸‹ï¼Œé¡è‰²é™„ä»¶è¢«è¨­ç½®ç‚º LoadAction.clear (å®ƒå°‡ç£ç£šè¨˜æ†¶é«”åˆå§‹åŒ–ç‚ºçµ¦å®šçš„é¡è‰²)ï¼Œä»¥åŠ StoreAction.store (å®ƒå°‡çµæœä¿å­˜åˆ°é™„åŠ çš„ç´‹ç†çš„ VRAM åˆ†é…ä¸­)ã€‚</p>
<p>ç¾åœ¨ï¼Œå»ºç«‹ä¸€å€‹å‘½ä»¤ç·©è¡å€ï¼Œä½¿ç”¨å‰é¢çš„æ¸²æŸ“ç›®æ¨™å¾ä¸­ç”Ÿæˆä¸€å€‹æ¸²æŸ“é€šé“ï¼Œç„¶å¾Œç«‹å³æäº¤å‘½ä»¤ç·©è¡å€ä»¥æ¸…é™¤ç´‹ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">final commandBuffer = gpu.gpuContext.createCommandBuffer();</span><br><span class="line">final renderPass = commandBuffer.createRenderPass(renderTarget);</span><br><span class="line">// ... ç¹ªè£½å‘¼å«å°‡åœ¨é€™è£¡åŸ·è¡Œï¼</span><br><span class="line">commandBuffer.submit();</span><br></pre></td></tr></table></figure>

<p>å‰©ä¸‹çš„å°±æ˜¯å°‡åˆå§‹åŒ–çš„ç´‹ç†ç¹ªè£½åˆ° Canvas ä¸­ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final image = texture.asImage();</span><br><span class="line">canvas.drawImage(image, Offset.zero, Paint());</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*ebUDtzQOuIGmdlop" />
</figure>

<p>ç¾åœ¨ä½ å·²ç¶“å°‡ä¸€å€‹æ¸²æŸ“é€šé“èˆ‡é¡¯ç¤ºåˆ°è¢å¹•ä¸Šçš„çµæœé€£æ¥èµ·ä¾†äº†ï¼Œä½ å°±å¯ä»¥é–‹å§‹ç¹ªè£½ä¸‰è§’å½¢äº†ã€‚ç‚ºæ­¤ï¼Œè«‹è¨­ç½®ä»¥ä¸‹å…§å®¹ï¼š</p>
<ol>
<li>å¾æˆ‘å€‘çš„è‘—è‰²å™¨å»ºç«‹çš„æ¸²æŸ“ç®¡é“ï¼Œä»¥åŠ</li>
<li>ä¸€å€‹åŒ…å«æˆ‘å€‘å¹¾ä½•é«”çš„ GPU å¯è¨ªå•ç·©è¡å€ (ä¸‰å€‹é ‚é»ä½ç½®)ã€‚</li>
</ol>
<p>å»ºç«‹æ¸²æŸ“ç®¡é“å¾ˆå®¹æ˜“ã€‚ä½ åªéœ€è¦å°‡ä½ çš„å‡½å¼åº«ä¸­çš„é ‚é»è‘—è‰²å™¨å’Œç‰‡æ®µè‘—è‰²å™¨çµ„åˆèµ·ä¾†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">final vert = shaderLibrary[&#x27;SimpleVertex&#x27;]!;</span><br><span class="line">final frag = shaderLibrary[&#x27;SimpleFragment&#x27;]!;</span><br><span class="line">final pipeline = gpu.gpuContext.createRenderPipeline(vert, frag);</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨æ˜¯å¹¾ä½•é«”ã€‚å›æƒ³ä¸€ä¸‹ï¼Œã€ŒSimpleVertexã€è‘—è‰²å™¨åªæœ‰ä¸€å€‹è¼¸å…¥ï¼šin vec2 positionã€‚å› æ­¤ï¼Œè¦ç¹ªè£½ä¸‰å€‹é ‚é»ï¼Œä½ éœ€è¦ä¸‰çµ„å…©å€‹æµ®é»æ•¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">final vertices = Float32List.fromList([</span><br><span class="line"> -0.5, -0.5, // ç¬¬ä¸€å€‹é ‚é»</span><br><span class="line"> 0.5, -0.5, // ç¬¬äºŒå€‹é ‚é»</span><br><span class="line"> 0.0, 0.5, // ç¬¬ä¸‰å€‹é ‚é»</span><br><span class="line">]);</span><br><span class="line">final verticesDeviceBuffer = gpu.gpuContext</span><br><span class="line"> .createDeviceBufferWithCopy(ByteData.sublistView(vertices))!;</span><br></pre></td></tr></table></figure>

<p>å‰©ä¸‹çš„å°±æ˜¯ç¶å®šæ–°çš„è³‡æºä¸¦å‘¼å« renderPass.draw() ä¾†å®Œæˆè¨˜éŒ„ç¹ªè£½å‘¼å«ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">renderPass.bindPipeline(pipeline);</span><br><span class="line"></span><br><span class="line">final verticesView = gpu.BufferView(</span><br><span class="line"> verticesDeviceBuffer,</span><br><span class="line"> offsetInBytes: 0,</span><br><span class="line"> lengthInBytes: verticesDeviceBuffer.sizeInBytes,</span><br><span class="line">);</span><br><span class="line">renderPass.bindVertexBuffer(verticesView, 3);</span><br><span class="line"></span><br><span class="line">renderPass.draw();</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ï¼Œä½ ç¾åœ¨æ‡‰è©²æœƒçœ‹åˆ°ä¸€å€‹ç¶ è‰²çš„ä¸‰è§’å½¢ï¼</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*LWnGU5WPT_Eom0wJ" />
</figure>

<p>å¤ªæ£’äº†ï¼Œä½ ä½¿ç”¨ Flutterã€Dart å’Œä¸€äº› GLSL å¾é ­é–‹å§‹å»ºç«‹äº†ä¸€å€‹æ¸²æŸ“å™¨ï¼</p>
<p>ç„¡è«–é€™æ˜¯å¦æ˜¯ä½ ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸‰è§’å½¢ï¼Œæˆ–è€…ä½ æ˜¯ä¸€ä½ç¶“é©—è±å¯Œçš„åœ–å½¢å°ˆå®¶ï¼Œæˆ‘éƒ½å¸Œæœ›ä½ ç¹¼çºŒä½¿ç”¨ Flutter GPU ä¸¦æŸ¥çœ‹æˆ‘å€‘æ­£åœ¨é–‹ç™¼çš„å¥—ä»¶ï¼Œä¾‹å¦‚ Flutter Sceneã€‚</p>
<p>å°‡ä¾†ï¼Œæˆ‘å€‘å¸Œæœ›ç™¼å¸ƒå‹å¥½çš„å…¥é–€ç¨‹å¼ç¢¼å¯¦é©—å®¤ï¼Œæ·±å…¥æ¢è¨ Flutter GPU çš„é è¨­è¡Œç‚ºå’Œæœ€ä½³å¯¦è¸ã€‚æˆ‘å€‘é‚„æ²’æœ‰è¨è«–é ‚é»å±¬æ€§ä½ˆå±€ã€ç´‹ç†ç¶å®šã€çµ±ä¸€å’Œå°é½Šè¦æ±‚ã€ç®¡é“æ··åˆã€æ·±åº¦å’Œæ¨¡æ¿é™„ä»¶ã€é€è¦–æ ¡æ­£ç­‰ç­‰ï¼</p>
<p>åœ¨é‚£ä¹‹å‰ï¼Œæˆ‘å»ºè­°ä½ æ¢ç´¢  Flutter Scene  ï¼Œä½œç‚ºå¦‚ä½•ä½¿ç”¨ Flutter GPU çš„ä¸€å€‹æ›´å…¨é¢çš„ç¯„ä¾‹ã€‚</p>
<h3 id="ä½¿ç”¨-Flutter-Scene-é€²è¡Œ-3D-æ¸²æŸ“"><a href="#ä½¿ç”¨-Flutter-Scene-é€²è¡Œ-3D-æ¸²æŸ“" class="headerlink" title="ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“"></a>ä½¿ç”¨ Flutter Scene é€²è¡Œ 3D æ¸²æŸ“</h3><p>Flutter Scene (å¥—ä»¶ flutter_scene) æ˜¯ä¸€å€‹æ–°çš„ç”± Flutter GPU æ”¯æ´çš„ 3D å ´æ™¯åœ–å¥—ä»¶ï¼Œå®ƒä½¿ Flutter é–‹ç™¼äººå“¡èƒ½å¤ åŒ¯å…¥å‹•ç•« glTF æ¨¡å‹ä¸¦æ¸²æŸ“å¯¦æ™‚ 3D å ´æ™¯ã€‚</p>
<p>æˆ‘å€‘çš„ç›®æ¨™æ˜¯æä¾›ä¸€å€‹å¥—ä»¶ï¼Œè®“ä½¿ç”¨ Flutter å»ºç«‹äº’å‹•å¼ 3D æ‡‰ç”¨ç¨‹å¼å’ŒéŠæˆ²è®Šå¾—å®¹æ˜“ã€‚</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/1024/0*tC68CbPLef2rJp1e" />
</figure>

<p>é€™å€‹å¥—ä»¶æœ€åˆæ˜¯ä¸€å€‹ä½¿ç”¨ C++ ç·¨å¯«çš„ 3D æ¸²æŸ“å™¨çš„ dart:ui æ“´å±•ï¼Œä¸¦ç›´æ¥æ§‹å»ºåˆ° Flutter çš„åŸç”ŸåŸ·è¡Œæ™‚ä¸­ï¼Œä½†å®ƒå·²é‡å° Flutter GPU é‡æ–°ç·¨å¯«ï¼Œä¸¦å…·æœ‰æ›´éˆæ´»çš„ä»‹é¢ã€‚</p>
<p>èˆ‡ Flutter GPU API æœ¬èº«ä¸€æ¨£ï¼ŒFlutter Scene ç›®å‰è™•æ–¼æ—©æœŸé è¦½éšæ®µï¼Œéœ€è¦å•Ÿç”¨ Impellerã€‚Flutter Scene é€šå¸¸èˆ‡ Flutter GPU API çš„é‡å¤§è®Šæ›´ä¿æŒåŒæ­¥ï¼Œå› æ­¤å¼·çƒˆå»ºè­°ä½ åœ¨å˜—è©¦ä½¿ç”¨ Flutter Scene æ™‚ä½¿ç”¨  ä¸»è¦é€šé“ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œä½¿ç”¨ Flutter Scene å»ºç«‹ä¸€å€‹æ‡‰ç”¨ç¨‹å¼ï¼</p>
<h3 id="è¨­å®šä¸€å€‹-Flutter-Scene-å°ˆæ¡ˆ"><a href="#è¨­å®šä¸€å€‹-Flutter-Scene-å°ˆæ¡ˆ" class="headerlink" title="è¨­å®šä¸€å€‹ Flutter Scene å°ˆæ¡ˆ"></a>è¨­å®šä¸€å€‹ Flutter Scene å°ˆæ¡ˆ</h3><p>ç”±æ–¼å¼·çƒˆå»ºè­°ä½ é‡å°  ä¸»è¦é€šé“  ä½¿ç”¨ Flutter Sceneï¼Œå› æ­¤è«‹å¾åˆ‡æ›åˆ°ä¸»è¦é€šé“é–‹å§‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter channel main</span><br><span class="line">flutter upgrade</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†ï¼Œå»ºç«‹ä¸€å€‹æ–°çš„ Flutter å°ˆæ¡ˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flutter create my_3d_app</span><br><span class="line">cd my_3d_app</span><br></pre></td></tr></table></figure>

<p>Flutter Scene ä¾è³´æ–¼å¯¦é©—æ€§çš„ã€ŒåŸç”Ÿè³‡ç”¢ã€åŠŸèƒ½ï¼Œä»¥è‡ªå‹•æ§‹å»ºè‘—è‰²å™¨ã€‚ä½ å°‡åœ¨ç¨å¾Œä½¿ç”¨åŸç”Ÿè³‡ç”¢ä¾†è¨­ç½® Flutter Scene çš„ 3D æ¨¡å‹çš„è‡ªå‹•åŒ¯å…¥ã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å•Ÿç”¨åŸç”Ÿè³‡ç”¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter config --enable-native-assets</span><br></pre></td></tr></table></figure>

<p>æœ€å¾Œï¼Œå°‡ Flutter Scene ä½œç‚ºå°ˆæ¡ˆä¾è³´é …æ·»åŠ ã€‚</p>
<p>ä½ é‚„éœ€è¦åœ¨èˆ‡ Flutter Scene çš„ API äº’å‹•æ™‚ä½¿ç”¨å¹¾å€‹ vector_math æ§‹é€ ï¼Œå› æ­¤ä¹Ÿæ·»åŠ  vector_math å¥—ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_scene vector_math</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹ä¾†ï¼ŒåŒ¯å…¥ä¸€å€‹ 3D æ¨¡å‹ï¼</p>
<h3 id="åŒ¯å…¥ä¸€å€‹-3D-æ¨¡å‹"><a href="#åŒ¯å…¥ä¸€å€‹-3D-æ¨¡å‹" class="headerlink" title="åŒ¯å…¥ä¸€å€‹ 3D æ¨¡å‹"></a>åŒ¯å…¥ä¸€å€‹ 3D æ¨¡å‹</h3><p>é¦–å…ˆï¼Œä½ éœ€è¦ä¸€å€‹è¦æ¸²æŸ“çš„ 3D æ¨¡å‹ã€‚åœ¨æœ¬æŒ‡å—ä¸­ï¼Œä½ å°‡ä½¿ç”¨ä¸€å€‹é€šç”¨çš„  glTF  æ¨£æœ¬è³‡ç”¢ï¼š  DamagedHelmet.glbã€‚ä»¥ä¸‹æ˜¯å®ƒçš„æ¨£å­ã€‚</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/912/0*vVWRLxJ348tCxv7T" />
<figcaption>åŸå§‹çš„ Damaged Helmet æ¨¡å‹æ˜¯ç”± theblueturtle_ åœ¨ 2016 å¹´å‰µå»ºçš„ (è¨±å¯è­‰ï¼š  CC BY-NC 4.0 åœ‹éš›è¨±å¯è­‰)ã€‚è½‰æ›å¾Œçš„ glTF ç‰ˆæœ¬æ˜¯ç”± ctxwing åœ¨ 2018 å¹´å‰µå»ºçš„ (è¨±å¯è­‰ï¼š  CC BY 4.0 åœ‹éš›è¨±å¯è­‰)</figcaption>
</figure>

<p>ä½ å¯ä»¥å¾  GitHub ä¸Šè¨—ç®¡çš„ glTF æ¨£æœ¬è³‡ç”¢åº«  ä¸­ç²å–å®ƒã€‚å°‡ DamagedHelmet.glb æ”¾ç½®åœ¨ä½ çš„å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/main/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb</span><br></pre></td></tr></table></figure>

<p>èˆ‡å¤§å¤šæ•¸å¯¦æ™‚ 3D æ¸²æŸ“å™¨ä¸€æ¨£ï¼ŒFlutter Scene åœ¨å…§éƒ¨ä½¿ç”¨å°ˆç”¨çš„ 3D æ¨¡å‹æ ¼å¼ã€‚ä½ å¯ä»¥ä½¿ç”¨ Flutter Scene çš„é›¢ç·šåŒ¯å…¥å·¥å…·å°‡æ¨™æº– glTF äºŒé€²åˆ¶æ–‡ä»¶ (.glb æ–‡ä»¶) è½‰æ›ç‚ºé€™ç¨®æ ¼å¼ã€‚</p>
<p>å°‡ flutter_scene_importer å¥—ä»¶ä½œç‚ºå¸¸è¦ä¾è³´é …æ·»åŠ åˆ°å°ˆæ¡ˆä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add flutter_scene_importer</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ é€™å€‹å¥—ä»¶å¾Œï¼Œå¯ä»¥ä½¿ç”¨ dart run æ‰‹å‹•å‘¼å«åŒ¯å…¥å™¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dart --enable-experiment=native-assets \</span><br><span class="line"> run flutter_scene_importer:import \</span><br><span class="line"> --input &quot;path/to/my/source_model.glb&quot; \</span><br><span class="line"> --output &quot;path/to/my/imported_model.model&quot;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥é€šéä½¿ç”¨åŸç”Ÿè³‡ç”¢æ§‹å»ºé‰¤å­ä¾†è‡ªå‹•åŸ·è¡ŒåŒ¯å…¥å™¨ã€‚ç‚ºæ­¤ï¼Œé¦–å…ˆå°‡ native_assets_cli ä½œç‚ºå¸¸è¦å°ˆæ¡ˆä¾è³´é …å®‰è£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter pub add native_assets_cli</span><br></pre></td></tr></table></figure>

<p>ç¾åœ¨ä½ å¯ä»¥ç·¨å¯«æ§‹å»ºé‰¤å­äº†ã€‚ä½¿ç”¨ä»¥ä¸‹å…§å®¹å»ºç«‹ hook&#x2F;build.dartã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;package:native_assets_cli/native_assets_cli.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene_importer/build_hooks.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main(List&lt;String&gt; args) &#123;</span><br><span class="line"> build(args, (config, output) async &#123;</span><br><span class="line"> buildModels(buildConfig: config, inputFilePaths: [</span><br><span class="line"> &#x27;DamagedHelmet.glb&#x27;,</span><br><span class="line"> ]);</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ flutter_scene_importer ä¸­çš„ buildModels å·¥å…·ï¼Œæä¾›è¦æ§‹å»ºçš„æ¨¡å‹åˆ—è¡¨ã€‚é€™äº›è·¯å¾‘ç›¸å°æ–¼å°ˆæ¡ˆçš„æ§‹å»ºæ ¹ç›®éŒ„ã€‚</p>
<p>ç•¶ Flutter å·¥å…·æ§‹å»ºå°ˆæ¡ˆæ™‚ï¼ŒbuildModels ç¾åœ¨å°‡æ§‹å»ºè‘—è‰²å™¨æ†ç¶åŒ…ï¼Œä¸¦å°‡çµæœè¼¸å‡ºåˆ°å¥—ä»¶æ ¹ç›®éŒ„ä¸‹çš„ build&#x2F;models&#x2F;DamagedModel.modelã€‚</p>
<p>åŒ¯å…¥çš„æ¨¡å‹æ ¼å¼æœ¬èº«èˆ‡ä½ ä½¿ç”¨çš„ Flutter Scene ç‰¹å®šç‰ˆæœ¬ç›¸é—œè¯ï¼Œä¸¦ä¸”æœƒéš¨è‘—æ™‚é–“çš„æ¨ç§»è€Œæ›´æ”¹ã€‚åœ¨ç·¨å¯«ä½¿ç”¨ Flutter Scene çš„æ‡‰ç”¨ç¨‹å¼æˆ–å‡½å¼åº«æ™‚ï¼Œè«‹ä¸è¦å°‡ç”Ÿæˆçš„ .model æ–‡ä»¶æª¢æŸ¥åˆ°ä½ çš„æºç¨‹å¼ç¢¼æ¨¹ä¸­ã€‚ç›¸åï¼Œè«‹ä½¿ç”¨æ§‹å»ºé‰¤å­å¾ä½ çš„æºæ¨¡å‹ç”Ÿæˆå®ƒå€‘ (å¦‚å‰æ‰€è¿°)ã€‚</p>
<p>é€™æ¨£ä¸€ä¾†ï¼Œéš¨è‘—ä½ å‡ç´š Flutter Sceneï¼Œä½ å°‡å§‹çµ‚ä½¿ç”¨æ­£ç¢ºæ ¼å¼æ§‹å»ºæ–°çš„ .model æ–‡ä»¶ï¼</p>
<p>æ¥ä¸‹ä¾†ï¼ŒåƒåŒ¯å…¥å¸¸è¦è³‡ç”¢ä¸€æ¨£åŒ¯å…¥æ¨¡å‹ã€‚åœ¨ä½ çš„å°ˆæ¡ˆçš„ pubspec.yaml ä¸­æ·»åŠ ä¸€å€‹è³‡ç”¢æ¢ç›®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flutter:</span><br><span class="line"> assets:</span><br><span class="line"> - build/models/</span><br></pre></td></tr></table></figure>

<p>å°‡ä¾†ï¼ŒåŸç”Ÿè³‡ç”¢åŠŸèƒ½å°‡å…è¨±æ§‹å»ºé‰¤å­å°‡æ•¸æ“šè³‡ç”¢é™„åŠ åˆ°æ†ç¶åŒ…ä¸­ã€‚ä¸€æ—¦ç™¼ç”Ÿé€™ç¨®æƒ…æ³ï¼Œå°±ä¸å†éœ€è¦æ·»åŠ è³‡ç”¢åŒ¯å…¥è¦å‰‡ä»¥åŠæ§‹å»ºé‰¤å­ã€‚</p>
<h3 id="æ¸²æŸ“ä¸€å€‹-3D-å ´æ™¯"><a href="#æ¸²æŸ“ä¸€å€‹-3D-å ´æ™¯" class="headerlink" title="æ¸²æŸ“ä¸€å€‹ 3D å ´æ™¯"></a>æ¸²æŸ“ä¸€å€‹ 3D å ´æ™¯</h3><p>ç¾åœ¨æ˜¯æ‡‰ç”¨ç¨‹å¼çš„ç¨‹å¼ç¢¼ã€‚</p>
<p>é¦–å…ˆï¼Œå»ºç«‹ä¸€å€‹æœ‰ç‹€æ…‹çš„å°éƒ¨ä»¶ä¾†è·¨å¹€æŒä¹…åŒ–å ´æ™¯ã€‚</p>
<p>ä½ å°‡æ ¹æ“šæ™‚é–“é€²è¡Œå‹•ç•«è™•ç†ï¼Œå› æ­¤å°‡ SingleTickerProviderStateMixin æ·»åŠ åˆ°ç‹€æ…‹ä»¥åŠ elapsedSeconds æˆå“¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:math&#x27;;</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter/scheduler.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/camera.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/node.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/scene.dart&#x27;;</span><br><span class="line">import &#x27;package:vector_math/vector_math.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"> runApp(const MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyApp extends StatefulWidget&#123;</span><br><span class="line"> const MyApp(&#123;super.key&#125;);</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> MyAppState createState() =&gt; MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyAppState extends State&lt;MyApp&gt; with SingleTickerProviderStateMixin &#123;</span><br><span class="line"> double elapsedSeconds = 0;</span><br><span class="line"> Scene scene = Scene();</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> Widget build(BuildContext context) &#123;</span><br><span class="line"> return MaterialApp(</span><br><span class="line"> title: &#x27;My 3D app&#x27;,</span><br><span class="line"> home: Placeholder(),</span><br><span class="line"> );</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ä½œç‚ºç…™éœ§æ¸¬è©¦ï¼Œä»¥ç¢ºä¿æ²’æœ‰éŒ¯èª¤ã€‚è«‹è¨˜ä½å•Ÿç”¨ Impellerï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run -d macos --enable-impeller</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/912/0*74qs6ytcTjyVHwML" />
</figure>

<p>åœ¨ç¹¼çºŒä¹‹å‰ï¼Œè«‹ç‚ºå‹•ç•«è¨­ç½®è¨ˆæ™‚å™¨ã€‚è¦†è“‹ MyAppState ä¸­çš„ initState ä»¥å‘¼å« createTickerã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void initState() &#123;</span><br><span class="line">createTicker((elapsed) &#123;</span><br><span class="line">setState(() &#123;</span><br><span class="line">elapsedSeconds = elapsed.inMilliseconds.toDouble() / 1000;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line">super.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦å°éƒ¨ä»¶å¯è¦‹ï¼Œè¨ˆæ™‚å™¨å›å‘¼å°±æœƒç‚ºæ¯ä¸€å¹€å‘¼å«ã€‚å‘¼å« setState å°‡è§¸ç™¼é€™å€‹å°éƒ¨ä»¶åœ¨æ¯ä¸€å¹€é‡æ–°æ§‹å»ºã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œè¼‰å…¥ä½ ä¹‹å‰æ”¾ç½®åœ¨å°ˆæ¡ˆä¸­çš„ 3D æ¨¡å‹ï¼Œä¸¦å°‡å…¶æ·»åŠ åˆ°å ´æ™¯ä¸­ã€‚</p>
<p>ä½¿ç”¨ Node.fromAsset å¾è³‡ç”¢æ†ç¶åŒ…ä¸­è¼‰å…¥æ¨¡å‹ã€‚å°‡ä»¥ä¸‹ç¨‹å¼ç¢¼æ”¾åœ¨ initState ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Node.fromAsset(&#x27;build/models/DamagedHelmet.model&#x27;).then((model) &#123;</span><br><span class="line">model.name = &#x27;Helmet&#x27;;</span><br><span class="line">scene.add(model);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Node.fromAsset ç•°æ­¥åœ°å¾è³‡ç”¢æ†ç¶åŒ…ä¸­ååºåˆ—åŒ–æ¨¡å‹ï¼Œä¸¦åœ¨æ¨¡å‹æº–å‚™å¥½æ·»åŠ åˆ°å ´æ™¯ä¸­æ™‚è§£æè¿”å›çš„ Future<Node>ã€‚</p>
<p>ç¾åœ¨ MyAppState.initState æ‡‰è©²å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void initState() &#123;</span><br><span class="line">createTicker((elapsed) &#123;</span><br><span class="line">setState(() &#123;</span><br><span class="line">elapsedSeconds = elapsed.inMilliseconds.toDouble() / 1000;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line">Node.fromAsset(&#x27;build/models/DamagedHelmet.model&#x27;).then((model) &#123;</span><br><span class="line">model.name = &#x27;Helmet&#x27;;</span><br><span class="line">scene.add(model);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">super.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œä½ ä»ç„¶æ²’æœ‰å¯¦éš›æ¸²æŸ“ 3D å ´æ™¯ï¼ç‚ºæ­¤ï¼Œè«‹ä½¿ç”¨ Scene.renderï¼Œå®ƒæ¥å—ä¸€å€‹ UI Canvasã€ä¸€å€‹ Flutter Scene ç›¸æ©Ÿå’Œä¸€å€‹å¤§å°ã€‚</p>
<p>è¨ªå• Canvas çš„ä¸€ç¨®æ–¹æ³•æ˜¯å»ºç«‹ä¸€å€‹è‡ªè¨‚ç¹ªè£½å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ScenePainter extends CustomPainter &#123;</span><br><span class="line"> ScenePainter(&#123;required this.scene, required this.camera&#125;);</span><br><span class="line"> Scene scene;</span><br><span class="line"> Camera camera;</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> void paint(Canvas canvas, Size size) &#123;</span><br><span class="line"> scene.render(camera, canvas, viewport: Offset.zero &amp; size);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> bool shouldRepaint(covariant CustomPainter oldDelegate) =&gt; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è¦å¿˜è¨˜å°‡ shouldRepaint è¦†è“‹è¨­ç½®ç‚ºè¿”å› trueï¼Œé€™æ¨£è‡ªè¨‚ç¹ªè£½å™¨å°±æœƒåœ¨æ¯æ¬¡é‡å»ºæ™‚é‡æ–°ç¹ªè£½ã€‚</p>
<p>æœ€å¾Œï¼Œå°‡è‡ªè¨‚ç¹ªè£½å™¨æ·»åŠ åˆ°æºç¨‹å¼ç¢¼æ¨¹ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">final painter = ScenePainter(</span><br><span class="line">scene: scene,</span><br><span class="line">camera: PerspectiveCamera(</span><br><span class="line">position: Vector3(sin(elapsedSeconds) * 3, 2, cos(elapsedSeconds) * 3),</span><br><span class="line">target: Vector3(0, 0, 0),</span><br><span class="line">),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">return MaterialApp(</span><br><span class="line">title: &#x27;My 3D app&#x27;,</span><br><span class="line">home: CustomPaint(painter: painter),</span><br><span class="line">);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€™æ®µç¨‹å¼ç¢¼æŒ‡ç¤ºç›¸æ©Ÿä»¥é€£çºŒçš„åœ“åœˆç§»å‹•ï¼Œä½†å§‹çµ‚é¢å‘åŸé»ã€‚</p>
<p>æœ€å¾Œï¼Œå•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run -d macos --enable-impeller</span><br></pre></td></tr></table></figure>

<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/796/0*_-OFc0vhBHAhrPrO" />
</figure>

<p>ä»¥ä¸‹æ˜¯æˆ‘å€‘æ•´ç†çš„å®Œæ•´æºç¨‹å¼ç¢¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;dart:math&#x27;;</span><br><span class="line"></span><br><span class="line">import &#x27;package:flutter/material.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/camera.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/node.dart&#x27;;</span><br><span class="line">import &#x27;package:flutter_scene/scene.dart&#x27;;</span><br><span class="line">import &#x27;package:vector_math/vector_math.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"> runApp(const MyApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyApp extends StatefulWidget &#123;</span><br><span class="line"> const MyApp(&#123;super.key&#125;);</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> MyAppState createState() =&gt; MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyAppState extends State&lt;MyApp&gt; with SingleTickerProviderStateMixin &#123;</span><br><span class="line"> double elapsedSeconds = 0;</span><br><span class="line"> Scene scene = Scene();</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> void initState() &#123;</span><br><span class="line"> createTicker((elapsed) &#123;</span><br><span class="line"> setState(() &#123;</span><br><span class="line"> elapsedSeconds = elapsed.inMilliseconds.toDouble() / 1000;</span><br><span class="line"> &#125;);</span><br><span class="line"> &#125;).start();</span><br><span class="line"></span><br><span class="line"> Node.fromAsset(&#x27;build/models/DamagedHelmet.model&#x27;).then((model) &#123;</span><br><span class="line"> model.name = &#x27;Helmet&#x27;;</span><br><span class="line"> scene.add(model);</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> super.initState();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> Widget build(BuildContext context) &#123;</span><br><span class="line"> final painter = ScenePainter(</span><br><span class="line"> scene: scene,</span><br><span class="line"> camera: PerspectiveCamera(</span><br><span class="line"> position: Vector3(sin(elapsedSeconds) * 3, 2, cos(elapsedSeconds) * 3),</span><br><span class="line"> target: Vector3(0, 0, 0),</span><br><span class="line"> ),</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"> return MaterialApp(</span><br><span class="line"> title: &#x27;My 3D app&#x27;,</span><br><span class="line"> home: CustomPaint(painter: painter),</span><br><span class="line"> );</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ScenePainter extends CustomPainter &#123;</span><br><span class="line"> ScenePainter(&#123;required this.scene, required this.camera&#125;);</span><br><span class="line"> Scene scene;</span><br><span class="line"> Camera camera;</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> void paint(Canvas canvas, Size size) &#123;</span><br><span class="line"> scene.render(camera, canvas, viewport: Offset.zero &amp; size);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> @override</span><br><span class="line"> bool shouldRepaint(covariant CustomPainter oldDelegate) =&gt; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="Flutter-å…‰æ˜çš„æœªä¾†"><a href="#Flutter-å…‰æ˜çš„æœªä¾†" class="headerlink" title="Flutter å…‰æ˜çš„æœªä¾†"></a>Flutter å…‰æ˜çš„æœªä¾†</h3><p>å¦‚æœä½ èƒ½å¤ æˆåŠŸåœ°éµå¾ªå…¶ä¸­ä¸€å€‹æŒ‡å—ä¸¦è®“å®ƒé‹è¡Œèµ·ä¾†ï¼šå“‡ï¼Œæ­å–œï¼</p>
<p>Flutter GPU å’Œ Flutter Scene éƒ½éå¸¸å¹´è¼•ï¼Œå¹³å°æ”¯æ´æœ‰é™ã€‚ä½†æˆ‘èªç‚ºæœ‰ä¸€å¤©æˆ‘å€‘æœƒæ‡·å¿µé€™äº›ä¸èµ·çœ¼çš„é–‹ç«¯ã€‚</p>
<p>æ†‘è—‰ Impeller çš„åŠªåŠ›ï¼ŒFlutter åœ˜éšŠå®Œå…¨æ“æœ‰äº†æ¸²æŸ“å †æ£§ï¼Œå› ç‚ºæˆ‘å€‘éœ€è¦å°‡æ¸²æŸ“å™¨å°ˆé–€ç”¨æ–¼ Flutter çš„ç”¨ä¾‹ã€‚ç¾åœ¨ï¼Œæˆ‘å€‘æ­£åœ¨é–‹å•Ÿ Flutter æ­·å²çš„æ–°ç¯‡ç« ã€‚ä¸€å€‹ç”±ä½ å…±åŒæ§åˆ¶æ¸²æŸ“çš„ç¯‡ç« ï¼</p>
<p>Flutter Scene æœ€åˆæ˜¯ Impeller ä¸­çš„ä¸€å€‹ C++ çµ„ä»¶ï¼Œèˆ‡ 2D Canvas æ¸²æŸ“å™¨ä»¥åŠä¸€å€‹ç²¾ç°¡çš„ dart:ui æ“´å±•ä¸€èµ·ã€‚åœ¨æˆ‘æ§‹å»ºå®ƒæ™‚ï¼Œæˆ‘å·²ç¶“æ„è­˜åˆ° Flutter å¼•æ“ä¸æœƒæ˜¯å®ƒçš„æœ€çµ‚ç›®çš„åœ°ã€‚</p>
<p>3D æ¸²æŸ“å™¨çš„æ¶æ§‹æ±ºç­–çš„æµ·æ´‹æ˜¯æµ©ç€šç„¡å çš„ï¼Œæ²’æœ‰å“ªä¸€ç¨®é€šç”¨çš„ 3D æ¸²æŸ“å™¨èƒ½å¤ å¾ˆå¥½åœ°è§£æ±ºæ‰€æœ‰ç”¨ä¾‹ã€‚ã€Œé€šç”¨ã€å’Œã€Œé«˜æ€§èƒ½ã€é€šå¸¸æ˜¯ç›¸äº’çŸ›ç›¾çš„ç›®æ¨™ã€‚</p>
<p>å……å…¶é‡ï¼Œåœ¨æ‰€æœ‰æ–¹é¢éƒ½é”åˆ°è¶³å¤ çš„æ°´æº–ï¼Œå¹¾ä¹ç­‰æ–¼åœ¨æ‰€æœ‰æ–¹é¢éƒ½ç„¡æ³•é”åˆ°å“è¶Šã€‚</p>
<p>åœ¨æ¸²æŸ“æ€§èƒ½çš„ä¸–ç•Œè£¡ï¼Œæƒ…æ³æ›´åŠ ç³Ÿç³•ã€‚å°ˆé–€é‡å°æŸä¸€å€‹ç”¨ä¾‹ï¼Œå¾€å¾€æ„å‘³è‘—é™ä½å¦ä¸€å€‹ç”¨ä¾‹çš„æ€§èƒ½ã€‚</p>
<p>ç°¡è€Œè¨€ä¹‹ï¼Œä¸å¯èƒ½ç™¼å¸ƒä¸€å€‹é€šç”¨çš„ 3D æ¸²æŸ“å™¨ï¼Œèƒ½å¤ ç‚ºæ‰€æœ‰äººè§£æ±ºæ‰€æœ‰ç”¨ä¾‹ã€‚ä½†æ˜¯ï¼Œé€šéå…¬é–‹æ§‹å»ºè‡ªå·±çš„è§£æ±ºæ–¹æ¡ˆæ‰€éœ€çš„ä½éš API (Flutter GPU)ï¼Œä»¥åŠåœ¨å®ƒçš„åŸºç¤ä¸Šæ§‹å»ºä¸€å€‹æœ‰ç”¨çš„é€šç”¨ 3D æ¸²æŸ“å™¨ï¼Œé€™å€‹æ¸²æŸ“å™¨æ˜“æ–¼ Flutter ç¤¾å€æª¢æŸ¥å’Œä¿®æ”¹ (Flutter Scene)ï¼Œæˆ‘å€‘æ­£åœ¨ç‚º Flutter é–‹ç™¼äººå“¡å‰µé€ ä¸€å€‹ç©ºé–“ï¼Œè®“ä»–å€‘å¯ä»¥äº«å—ä½é¢¨éšªçš„éæ™‚é¢¨éšªå’Œé«˜å›å ±ã€‚</p>
<figure>
<img alt="" src="https://cdn-images-1.medium.com/max/506/1*jfeUgpEP9AgAz94yVxVW1g.gif" />
</figure>

<p>æˆ‘è¿«ä¸åŠå¾…åœ°æƒ³çœ‹çœ‹ä½ æœƒç”¨é€™äº›æ–°åŠŸèƒ½åšäº›ä»€éº¼ã€‚æ•¬è«‹æœŸå¾… Flutter Scene çš„æœªä¾†ç‰ˆæœ¬ã€‚æœ‰å¾ˆå¤šæ±è¥¿æ­£åœ¨è·¯ä¸Šã€‚</p>
<p>åŒæ™‚ï¼Œæˆ‘è¦å›åˆ°å·¥ä½œå´—ä½äº†ã€‚</p>
<p>å¾ˆå¿«å°±æœƒè¦‹åˆ°ä½ ã€‚:)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.rainvisitor.me/archives/8ddf18fb.html" data-id="cm1khy3qe0000yo171ysg7laz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flutter/" rel="tag">Flutter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GPU/" rel="tag">GPU</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/archives/430aae7c.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ã€æ–‡ç« ç¿»è­¯ã€‘Whatâ€™s new in Flutter 3.24</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/" rel="tag">Flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU/" rel="tag">GPU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Flutter/" style="font-size: 20px;">Flutter</a> <a href="/tags/GPU/" style="font-size: 10px;">GPU</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">å…«æœˆ 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">åæœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">å…«æœˆ 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/archives/8ddf18fb.html">ã€æ–‡ç« ç¿»è­¯ã€‘Getting started with Flutter GPU</a>
          </li>
        
          <li>
            <a href="/archives/430aae7c.html">ã€æ–‡ç« ç¿»è­¯ã€‘Whatâ€™s new in Flutter 3.24</a>
          </li>
        
          <li>
            <a href="/archives/4254a2e9.html">Android app ä¸Šæ¶æµç¨‹</a>
          </li>
        
          <li>
            <a href="/archives/dc2c1f00.html">iOS app ä¸Šæ¶æµç¨‹</a>
          </li>
        
          <li>
            <a href="/archives/b0c060c4.html">window 10 å®‰è£ docker ç„¡æ³•é–‹å•Ÿ å•é¡Œ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 Rainvisitor<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FZZFH3T2TV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FZZFH3T2TV');
</script>
  </div>
</body>
</html>